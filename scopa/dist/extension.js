(()=>{"use strict";var e,t={828:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.f32=t.char=t.byte=t.bool=t.WasmContext=t.VariantType=t.Uint8ArrayType=t.Uint32ArrayType=t.Uint16ArrayType=t.TupleType=t.StaticMethodType=t.ResultType=t.ResultError=t.ResourceType=t.ResourceManagers=t.ResourceManager=t.ResourceHandleType=t.Resource=t.RecordType=t.ReadonlyMemoryRange=t.PackageType=t.OwnType=t.Options=t.OptionType=t.MethodType=t.MemoryRange=t.MemoryError=t.Memory=t.ListType=t.InterfaceType=t.Int8ArrayType=t.Int32ArrayType=t.Int16ArrayType=t.FunctionType=t.FlatTypeKind=t.FlagsType=t.EnumType=t.DestructorType=t.ConstructorType=t.ComponentModelTypeKind=t.ComponentModelTrap=t.ComponentModelContext=t.BorrowType=t.BigUint64ArrayType=t.BigInt64ArrayType=t.BaseMemoryRange=t.Alignment=t.$main=t.$imports=t.$exports=void 0,t.RAL=t.Connection=t.wstring=t.u8=t.u64=t.u32=t.u16=t.size=t.s8=t.s64=t.s32=t.s16=t.result=t.ptr=t.option=t.i64=t.i32=t.float64=t.float32=t.f64=void 0;const o=r(n(927));t.RAL=o.default;var i=n(190);Object.defineProperty(t,"$exports",{enumerable:!0,get:function(){return i.$exports}}),Object.defineProperty(t,"$imports",{enumerable:!0,get:function(){return i.$imports}}),Object.defineProperty(t,"$main",{enumerable:!0,get:function(){return i.$main}}),Object.defineProperty(t,"Alignment",{enumerable:!0,get:function(){return i.Alignment}}),Object.defineProperty(t,"BaseMemoryRange",{enumerable:!0,get:function(){return i.BaseMemoryRange}}),Object.defineProperty(t,"BigInt64ArrayType",{enumerable:!0,get:function(){return i.BigInt64ArrayType}}),Object.defineProperty(t,"BigUint64ArrayType",{enumerable:!0,get:function(){return i.BigUint64ArrayType}}),Object.defineProperty(t,"BorrowType",{enumerable:!0,get:function(){return i.BorrowType}}),Object.defineProperty(t,"ComponentModelContext",{enumerable:!0,get:function(){return i.ComponentModelContext}}),Object.defineProperty(t,"ComponentModelTrap",{enumerable:!0,get:function(){return i.ComponentModelTrap}}),Object.defineProperty(t,"ComponentModelTypeKind",{enumerable:!0,get:function(){return i.ComponentModelTypeKind}}),Object.defineProperty(t,"ConstructorType",{enumerable:!0,get:function(){return i.ConstructorType}}),Object.defineProperty(t,"DestructorType",{enumerable:!0,get:function(){return i.DestructorType}}),Object.defineProperty(t,"EnumType",{enumerable:!0,get:function(){return i.EnumType}}),Object.defineProperty(t,"FlagsType",{enumerable:!0,get:function(){return i.FlagsType}}),Object.defineProperty(t,"FlatTypeKind",{enumerable:!0,get:function(){return i.FlatTypeKind}}),Object.defineProperty(t,"FunctionType",{enumerable:!0,get:function(){return i.FunctionType}}),Object.defineProperty(t,"Int16ArrayType",{enumerable:!0,get:function(){return i.Int16ArrayType}}),Object.defineProperty(t,"Int32ArrayType",{enumerable:!0,get:function(){return i.Int32ArrayType}}),Object.defineProperty(t,"Int8ArrayType",{enumerable:!0,get:function(){return i.Int8ArrayType}}),Object.defineProperty(t,"InterfaceType",{enumerable:!0,get:function(){return i.InterfaceType}}),Object.defineProperty(t,"ListType",{enumerable:!0,get:function(){return i.ListType}}),Object.defineProperty(t,"Memory",{enumerable:!0,get:function(){return i.Memory}}),Object.defineProperty(t,"MemoryError",{enumerable:!0,get:function(){return i.MemoryError}}),Object.defineProperty(t,"MemoryRange",{enumerable:!0,get:function(){return i.MemoryRange}}),Object.defineProperty(t,"MethodType",{enumerable:!0,get:function(){return i.MethodType}}),Object.defineProperty(t,"OptionType",{enumerable:!0,get:function(){return i.OptionType}}),Object.defineProperty(t,"Options",{enumerable:!0,get:function(){return i.Options}}),Object.defineProperty(t,"OwnType",{enumerable:!0,get:function(){return i.OwnType}}),Object.defineProperty(t,"PackageType",{enumerable:!0,get:function(){return i.PackageType}}),Object.defineProperty(t,"ReadonlyMemoryRange",{enumerable:!0,get:function(){return i.ReadonlyMemoryRange}}),Object.defineProperty(t,"RecordType",{enumerable:!0,get:function(){return i.RecordType}}),Object.defineProperty(t,"Resource",{enumerable:!0,get:function(){return i.Resource}}),Object.defineProperty(t,"ResourceHandleType",{enumerable:!0,get:function(){return i.ResourceHandleType}}),Object.defineProperty(t,"ResourceManager",{enumerable:!0,get:function(){return i.ResourceManager}}),Object.defineProperty(t,"ResourceManagers",{enumerable:!0,get:function(){return i.ResourceManagers}}),Object.defineProperty(t,"ResourceType",{enumerable:!0,get:function(){return i.ResourceType}}),Object.defineProperty(t,"ResultError",{enumerable:!0,get:function(){return i.ResultError}}),Object.defineProperty(t,"ResultType",{enumerable:!0,get:function(){return i.ResultType}}),Object.defineProperty(t,"StaticMethodType",{enumerable:!0,get:function(){return i.StaticMethodType}}),Object.defineProperty(t,"TupleType",{enumerable:!0,get:function(){return i.TupleType}}),Object.defineProperty(t,"Uint16ArrayType",{enumerable:!0,get:function(){return i.Uint16ArrayType}}),Object.defineProperty(t,"Uint32ArrayType",{enumerable:!0,get:function(){return i.Uint32ArrayType}}),Object.defineProperty(t,"Uint8ArrayType",{enumerable:!0,get:function(){return i.Uint8ArrayType}}),Object.defineProperty(t,"VariantType",{enumerable:!0,get:function(){return i.VariantType}}),Object.defineProperty(t,"WasmContext",{enumerable:!0,get:function(){return i.WasmContext}}),Object.defineProperty(t,"bool",{enumerable:!0,get:function(){return i.bool}}),Object.defineProperty(t,"byte",{enumerable:!0,get:function(){return i.byte}}),Object.defineProperty(t,"char",{enumerable:!0,get:function(){return i.char}}),Object.defineProperty(t,"f32",{enumerable:!0,get:function(){return i.f32}}),Object.defineProperty(t,"f64",{enumerable:!0,get:function(){return i.f64}}),Object.defineProperty(t,"float32",{enumerable:!0,get:function(){return i.float32}}),Object.defineProperty(t,"float64",{enumerable:!0,get:function(){return i.float64}}),Object.defineProperty(t,"i32",{enumerable:!0,get:function(){return i.i32}}),Object.defineProperty(t,"i64",{enumerable:!0,get:function(){return i.i64}}),Object.defineProperty(t,"option",{enumerable:!0,get:function(){return i.option}}),Object.defineProperty(t,"ptr",{enumerable:!0,get:function(){return i.ptr}}),Object.defineProperty(t,"result",{enumerable:!0,get:function(){return i.result}}),Object.defineProperty(t,"s16",{enumerable:!0,get:function(){return i.s16}}),Object.defineProperty(t,"s32",{enumerable:!0,get:function(){return i.s32}}),Object.defineProperty(t,"s64",{enumerable:!0,get:function(){return i.s64}}),Object.defineProperty(t,"s8",{enumerable:!0,get:function(){return i.s8}}),Object.defineProperty(t,"size",{enumerable:!0,get:function(){return i.size}}),Object.defineProperty(t,"u16",{enumerable:!0,get:function(){return i.u16}}),Object.defineProperty(t,"u32",{enumerable:!0,get:function(){return i.u32}}),Object.defineProperty(t,"u64",{enumerable:!0,get:function(){return i.u64}}),Object.defineProperty(t,"u8",{enumerable:!0,get:function(){return i.u8}}),Object.defineProperty(t,"wstring",{enumerable:!0,get:function(){return i.wstring}});var s=n(842);Object.defineProperty(t,"Connection",{enumerable:!0,get:function(){return s.Connection}})},190:function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return o(t,e),t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.VariantType=t.FlagsType=t.tuple=t.TupleType=t.RecordType=t.Float64ArrayType=t.Float32ArrayType=t.BigUint64ArrayType=t.Uint32ArrayType=t.Uint16ArrayType=t.Uint8ArrayType=t.BigInt64ArrayType=t.Int32ArrayType=t.Int16ArrayType=t.Int8ArrayType=t.list=t.ListType=t.wstring=t.char=t.ptr=t.size=t.byte=t.float64=t.float32=t.s64=t.s32=t.s16=t.s8=t.u64=t.u32=t.u16=t.u8=t.bool=t.ResultError=t.ComponentModelContext=t.ComponentModelTypeKind=t.FlatTuple=t.f64=t.f32=t.i64=t.i32=t.FlatTypeKind=t.Options=t.Memory=t.MemoryRange=t.ReadonlyMemoryRange=t.BaseMemoryRange=t.MemoryError=t.Alignment=t.ComponentModelTrap=void 0,t.$main=t.$exports=t.$imports=t.WasmContext=t.PackageType=t.InterfaceType=t.OwnType=t.BorrowType=t.ResourceType=t.ResourceHandleType=t.MethodType=t.StaticMethodType=t.DestructorType=t.ConstructorType=t.FunctionType=t.ResourceManagers=t.ResourceManager=t.Resource=t.ResultType=t.result=t.OptionType=t.option=t.EnumType=void 0;const a=i(n(899)),l=s(n(927));if(1!==new Uint8Array(new Uint16Array([1]).buffer)[0])throw new Error("Big endian platforms are currently not supported.");class c extends Error{constructor(e){super(e)}}var u;t.ComponentModelTrap=c,function(e){const t=BigInt(Number.MAX_VALUE);e.asNumber=function(e){if(e>t)throw new c("Value too big for number");return Number(e)},e.max=function(...e){return e.reduce(((e,t)=>t>e?t:e))},e.min=function(...e){return e.reduce(((e,t)=>t<e?t:e))}}(u||(u={}));const f=(0,l.default)().TextDecoder.create("utf-8"),p=(0,l.default)().TextEncoder.create("utf-8");var d;!function(e){e[e.byte=1]="byte",e[e.halfWord=2]="halfWord",e[e.word=4]="word",e[e.doubleWord=8]="doubleWord"}(d||(t.Alignment=d={})),function(e){e.align=function(e,t){return Math.ceil(e/t)*t},e.getAlignment=function(t){return t%e.doubleWord==0?e.doubleWord:t%e.word==0?e.word:t%e.halfWord==0?e.halfWord:e.byte}}(d||(t.Alignment=d={}));const y=d.align;class h extends c{constructor(e){super(e)}}t.MemoryError=h;class m{_memory;_ptr;_size;_alignment;_view;constructor(e,t,n){this._memory=e,this._ptr=t,this._size=n,this._alignment=d.getAlignment(t)}get memory(){return this._memory}get ptr(){return this._ptr}get size(){return this._size}get alignment(){return this._alignment}get view(){return void 0!==this._view&&this._view.buffer===this._memory.buffer||(this._view=new DataView(this._memory.buffer,this._ptr,this._size)),this._view}getUint8(e){return this.view.getUint8(e)}getInt8(e){return this.view.getInt8(e)}getUint16(e){return this.assertAlignment(e,d.halfWord),this.view.getUint16(e,!0)}getInt16(e){return this.assertAlignment(e,d.halfWord),this.view.getInt16(e,!0)}getUint32(e){return this.assertAlignment(e,d.word),this.view.getUint32(e,!0)}getInt32(e){return this.assertAlignment(e,d.word),this.view.getInt32(e,!0)}getUint64(e){return this.assertAlignment(e,d.doubleWord),this.view.getBigUint64(e,!0)}getInt64(e){return this.assertAlignment(e,d.doubleWord),this.view.getBigInt64(e,!0)}getFloat32(e){return this.assertAlignment(e,d.word),this.view.getFloat32(e,!0)}getFloat64(e){return this.assertAlignment(e,d.doubleWord),this.view.getFloat64(e,!0)}getPtr(e){return this.assertAlignment(e,d.word),this.view.getUint32(e,!0)}getUint8Array(e,t){return this.getArray(e,t,Uint8Array)}getInt8Array(e,t){return this.getArray(e,t,Int8Array)}getUint16Array(e,t){return this.getArray(e,t,Uint16Array)}getInt16Array(e,t){return this.getArray(e,t,Int16Array)}getUint32Array(e,t){return this.getArray(e,t,Uint32Array)}getInt32Array(e,t){return this.getArray(e,t,Int32Array)}getUint64Array(e,t){return this.getBigArray(e,t,BigUint64Array)}getInt64Array(e,t){return this.getBigArray(e,t,BigInt64Array)}getFloat32Array(e,t){return this.getArray(e,t,Float32Array)}getFloat64Array(e,t){return this.getArray(e,t,Float64Array)}copyBytes(e,t,n,r){if(e+t>this.size)throw new h(`Memory access is out of bounds. Accessing [${e}, ${t}], allocated[${this.ptr}, ${this.size}]`);n.getUint8View(r,t).set(new Uint8Array(this._memory.buffer,this.ptr+e,t))}assertAlignment(e,t){if(t>this.alignment||e%t!=0)throw new h(`Memory location is not aligned to ${t}. Allocated[${this.ptr},${this.size}]`)}getArray(e,t,n){if(t=t??(this.size-e)/n.BYTES_PER_ELEMENT,!Number.isInteger(t))throw new h(`Length must be an integer value. Got ${t}.`);const r=new n(t);return r.set(new n(this._memory.buffer,this.ptr+e,t)),r}getBigArray(e,t,n){if(t=t??(this.size-e)/n.BYTES_PER_ELEMENT,!Number.isInteger(t))throw new h(`Length must be an integer value. Got ${t}.`);const r=new n(t);return r.set(new n(this._memory.buffer,this.ptr+e,t)),r}}t.BaseMemoryRange=m;class g extends m{constructor(e,t,n){super(e,t,n)}range(e,t){if(e+t>this.size)throw new h(`Memory access is out of bounds. Accessing [${e}, ${t}], allocated[${this.ptr}, ${this.size}]`);return new g(this._memory,this.ptr+e,t)}}t.ReadonlyMemoryRange=g;class w extends m{isAllocated;constructor(e,t,n,r=!1){super(e,t,n),this.isAllocated=r}free(){if("function"!=typeof this._memory.free)throw new h("Memory doesn't support free");this._memory.free(this)}range(e,t){if(e+t>this.size)throw new h(`Memory access is out of bounds. Accessing [${e}, ${t}], allocated[${this.ptr}, ${this.size}]`);return new w(this._memory,this.ptr+e,t)}setUint8(e,t){this.view.setUint8(e,t)}setInt8(e,t){this.view.setInt8(e,t)}setUint16(e,t){this.assertAlignment(e,d.halfWord),this.view.setUint16(e,t,!0)}setInt16(e,t){this.assertAlignment(e,d.halfWord),this.view.setInt16(e,t,!0)}setUint32(e,t){this.assertAlignment(e,d.word),this.view.setUint32(e,t,!0)}setInt32(e,t){this.assertAlignment(e,d.word),this.view.setInt32(e,t,!0)}setUint64(e,t){this.assertAlignment(e,d.doubleWord),this.view.setBigUint64(e,t,!0)}setInt64(e,t){this.assertAlignment(e,d.doubleWord),this.view.setBigInt64(e,t,!0)}setFloat32(e,t){this.assertAlignment(e,d.word),this.view.setFloat32(e,t,!0)}setFloat64(e,t){this.assertAlignment(e,d.doubleWord),this.view.setFloat64(e,t,!0)}setPtr(e,t){this.assertAlignment(e,d.word),this.view.setUint32(e,t,!0)}getUint8View(e,t){return this.getArrayView(e,t,Uint8Array)}getInt8View(e,t){return this.getArrayView(e,t,Int8Array)}getUint16View(e,t){return this.getArrayView(e,t,Uint16Array)}getInt16View(e,t){return this.getArrayView(e,t,Int16Array)}getUint32View(e,t){return this.getArrayView(e,t,Uint32Array)}getInt32View(e,t){return this.getArrayView(e,t,Int32Array)}getUint64View(e,t){return this.getBigArrayView(e,t,BigUint64Array)}getInt64View(e,t){return this.getBigArrayView(e,t,BigInt64Array)}getFloat32View(e,t){return this.getArrayView(e,t,Float32Array)}getFloat64View(e,t){return this.getArrayView(e,t,Float64Array)}setUint8Array(e,t){this.setArray(e,t,Uint8Array)}setInt8Array(e,t){this.setArray(e,t,Int8Array)}setUint16Array(e,t){this.setArray(e,t,Uint16Array)}setInt16Array(e,t){this.setArray(e,t,Int16Array)}setUint32Array(e,t){this.setArray(e,t,Uint32Array)}setInt32Array(e,t){this.setArray(e,t,Int32Array)}setUint64Array(e,t){this.setBigArray(e,t,BigUint64Array)}setInt64Array(e,t){this.setBigArray(e,t,BigInt64Array)}setFloat32Array(e,t){this.setArray(e,t,Float32Array)}setFloat64Array(e,t){this.setArray(e,t,Float64Array)}getArrayView(e,t,n){if(t=t??(this.size-e)/n.BYTES_PER_ELEMENT,!Number.isInteger(t))throw new h(`Length must be an integer value. Got ${t}.`);return new n(this._memory.buffer,this.ptr+e,t)}getBigArrayView(e,t,n){if(t=t??(this.size-e)/n.BYTES_PER_ELEMENT,!Number.isInteger(t))throw new h(`Length must be an integer value. Got ${t}.`);return new n(this._memory.buffer,this.ptr+e,t)}setArray(e,t,n){new n(this._memory.buffer,this.ptr+e,t.length).set(t)}setBigArray(e,t,n){new n(this._memory.buffer,this.ptr+e,t.length).set(t)}}t.MemoryRange=w;class v{id="b60336d2-c856-4767-af3b-f66e1ab6c507";buffer=new ArrayBuffer(0);alloc(){throw new h("Cannot allocate memory on a null memory.")}realloc(){throw new h("Cannot re-allocate memory on a null memory.")}preAllocated(){throw new h("Cannot point to pre-allocate memory on a null memory.")}readonly(){throw new h("Cannot point to readonly memory on a null memory.")}free(){throw new h("Cannot free memory on a null memory.")}}var b,T,A,_,x,$,F,M,O,I,z,U,R,P,E,j,C,N,k,W,V,S,B,L,H,D,K,G,J,X,Y,q,Q,Z,ee,te,ne,re,oe,ie,se,ae;!function(e){e.Null=new v,e.Default=class{id;memory;cabi_realloc;constructor(e,t){if(void 0===e.memory||void 0===e.cabi_realloc)throw new h("The exports object must contain a memory object and a cabi_realloc function.");this.id=t??a.v4(),this.memory=e.memory,this.cabi_realloc=e.cabi_realloc}get buffer(){return this.memory.buffer}alloc(e,t){const n=this.cabi_realloc(0,0,e,t);return new w(this,n,t)}realloc(e,t){const n=this.cabi_realloc(e.ptr,e.size,e.alignment,t);return new w(this,n,t)}preAllocated(e,t){return new w(this,e,t)}readonly(e,t){return new g(this,e,t)}}}(b||(t.Memory=b={})),function(e){e.is=function(e){const t=e;return t&&"string"==typeof t.encoding&&(void 0===t.keepOption||"boolean"==typeof t.keepOption)}}(T||(t.Options=T={})),function(e){e.i32="i32",e.i64="i64",e.f32="f32",e.f64="f64"}(A||(t.FlatTypeKind=A={})),function(e){e.kind=A.i32,e.size=4,e.alignment=d.word,e.load=function(e,t){return e.getUint32(t)},e.store=function(e,t,n){e.setUint32(t,n)},e.copy=function(t,n,r,o){t.assertAlignment(n,e.alignment),r.assertAlignment(o,e.alignment),r.copyBytes(o,e.size,t,n)}}(_||(_={})),t.i32=_,function(e){e.kind=A.i64,e.size=8,e.alignment=d.doubleWord,e.load=function(e,t){return e.getUint64(t)},e.store=function(e,t,n){e.setUint64(t,n)},e.copy=function(t,n,r,o){t.assertAlignment(n,e.alignment),r.assertAlignment(o,e.alignment),r.copyBytes(o,e.size,t,n)}}(x||(x={})),t.i64=x,function(e){e.kind=A.f32,e.size=4,e.alignment=d.word,e.load=function(e,t){return e.getFloat32(t)},e.store=function(e,t,n){e.setFloat32(t,n)},e.copy=function(t,n,r,o){t.assertAlignment(n,e.alignment),r.assertAlignment(o,e.alignment),r.copyBytes(o,e.size,t,n)}}($||($={})),t.f32=$,function(e){e.kind=A.f64,e.size=8,e.alignment=d.doubleWord,e.load=function(e,t){return e.getFloat64(t)},e.store=function(e,t,n){e.setFloat64(t,n)},e.copy=function(t,n,r,o){t.assertAlignment(n,e.alignment),r.assertAlignment(o,e.alignment),r.copyBytes(o,e.size,t,n)}}(F||(F={})),t.f64=F;class le{types;alignment;size;constructor(e){this.types=e,this.alignment=le.alignment(e),this.size=le.size(e,this.alignment)}load(e,t){e.assertAlignment(t,this.alignment);const n=[];for(const r of this.types)t=y(t,r.alignment),n.push(r.load(e,t)),t+=r.size;return n}alloc(e){return e.alloc(this.alignment,this.size)}store(e,t,n){e.assertAlignment(t,this.alignment);for(const[r,o]of this.types.entries()){const i=n[r];t=y(t,o.alignment),o.store(e,t,i),t+=o.size}}copy(e,t,n,r){e.assertAlignment(t,this.alignment),n.assertAlignment(r,this.alignment),n.copyBytes(r,this.size,e,t)}static alignment(e){let t=d.byte;for(const n of e)t=Math.max(t,n.alignment);return t}static size(e,t){let n=0;for(const t of e)n=y(n,t.alignment),n+=t.size;return y(n,t)}}t.FlatTuple=le,function(e){const t=new DataView(new ArrayBuffer(4)),n=new DataView(new ArrayBuffer(8));function r(e){return t.setInt32(0,e,!0),t.getFloat32(0,!0)}function o(e){return t.setFloat32(0,e,!0),t.getInt32(0,!0)}function i(e){return u.asNumber(e)}function s(e){return BigInt(e)}e.reinterpret_i32_as_f32=r,e.reinterpret_f32_as_i32=o,e.convert_i64_to_i32=i,e.convert_i32_to_i64=s,e.reinterpret_i64_as_f32=function(e){return r(i(e))},e.reinterpret_f32_as_i64=function(e){return s(o(e))},e.reinterpret_i64_as_f64=function(e){return n.setBigInt64(0,e,!0),n.getFloat64(0,!0)},e.reinterpret_f64_as_i64=function(e){return n.setFloat64(0,e,!0),n.getBigInt64(0,!0)}}(M||(M={}));class ce{values;haveFlatTypes;wantFlatTypes;index;constructor(e,t,n){if(this.values=e,this.haveFlatTypes=t,this.wantFlatTypes=n,t.length<n.length)throw new c(`Invalid coercion: have ${t.length} values, want ${n.length} values`);this.index=0}next(){const e=this.values.next();if(e.done)return e;const t=this.haveFlatTypes[this.index],n=this.wantFlatTypes[this.index++];return t===_&&n===$?{done:!1,value:M.reinterpret_i32_as_f32(e.value)}:t===x&&n===_?{done:!1,value:M.convert_i64_to_i32(e.value)}:t===x&&n===$?{done:!1,value:M.reinterpret_i64_as_f32(e.value)}:t===x&&n===F?{done:!1,value:M.reinterpret_i64_as_f64(e.value)}:e}}!function(e){e.bool="bool",e.u8="u8",e.u16="u16",e.u32="u32",e.u64="u64",e.s8="s8",e.s16="s16",e.s32="s32",e.s64="s64",e.float32="float32",e.float64="float64",e.char="char",e.string="string",e.list="list",e.record="record",e.tuple="tuple",e.variant="variant",e.enum="enum",e.flags="flags",e.option="option",e.result="result",e.resource="resource",e.resourceHandle="resourceHandle",e.borrow="borrow",e.own="own"}(O||(t.ComponentModelTypeKind=O={})),function(e){e.is=function(e){const t=e;return t&&T.is(t.options)&&Z.is(t.resources)}}(I||(t.ComponentModelContext=I={})),function(e){e.satisfies=function(e){}}(z||(z={}));class ue extends Error{cause;constructor(e,t){super(e,{cause:t}),this.cause=t}}t.ResultError=ue,function(e){e.kind=O.bool,e.size=1,e.alignment=d.byte,e.flatTypes=[_],e.load=function(e,t){return 0!==e.getUint8(t)},e.liftFlat=function(e,t){const n=t.next().value;if(n<0)throw new c(`Invalid bool value ${n}`);return 0!==n},e.alloc=function(t){return t.alloc(e.alignment,e.size)},e.store=function(e,t,n){e.setUint8(t,n?1:0)},e.lowerFlat=function(e,t,n){e.push(n?1:0)},e.copy=function(t,n,r,o){r.copyBytes(o,e.size,t,n)},e.copyFlat=function(e,t,n,r){e.push(n.next().value)},e.Error=class extends ue{constructor(e){super(`Error value: ${e}`,e)}}}(U||(t.bool=U={})),z.satisfies(U),function(e){e.kind=O.u8,e.size=1,e.alignment=d.byte,e.flatTypes=[_],e.LOW_VALUE=0,e.HIGH_VALUE=255,e.load=function(e,t){return e.getUint8(t)},e.liftFlat=function(t,n){const r=n.next().value;if(r<e.LOW_VALUE||r>e.HIGH_VALUE||!Number.isInteger(r))throw new c(`Invalid u8 value ${r}`);return r},e.alloc=function(t){return t.alloc(e.alignment,e.size)},e.store=function(e,t,n){e.setUint8(t,n)},e.lowerFlat=function(t,n,r){if(r<e.LOW_VALUE||r>e.HIGH_VALUE||!Number.isInteger(r))throw new c(`Invalid u8 value ${r}`);t.push(r)},e.copy=function(t,n,r,o){r.copyBytes(o,e.size,t,n)},e.copyFlat=function(e,t,n,r){e.push(n.next().value)},e.Error=class extends ue{constructor(e){super(`Error value: ${e}`,e)}}}(R||(t.u8=R={})),z.satisfies(R),function(e){e.kind=O.u16,e.size=2,e.alignment=d.halfWord,e.flatTypes=[_],e.LOW_VALUE=0,e.HIGH_VALUE=65535,e.load=function(e,t){return e.getUint16(t)},e.liftFlat=function(t,n){const r=n.next().value;if(r<e.LOW_VALUE||r>e.HIGH_VALUE||!Number.isInteger(r))throw new c(`Invalid u16 value ${r}`);return r},e.alloc=function(t){return t.alloc(e.alignment,e.size)},e.store=function(e,t,n){e.setUint16(t,n)},e.lowerFlat=function(t,n,r){if(r<e.LOW_VALUE||r>e.HIGH_VALUE||!Number.isInteger(r))throw new c(`Invalid u16 value ${r}`);t.push(r)},e.copy=function(t,n,r,o){t.assertAlignment(n,e.alignment),r.assertAlignment(o,e.alignment),r.copyBytes(o,e.size,t,n)},e.copyFlat=function(e,t,n,r){e.push(n.next().value)},e.Error=class extends ue{constructor(e){super(`Error value: ${e}`,e)}}}(P||(t.u16=P={})),z.satisfies(P),function(e){e.kind=O.u32,e.size=4,e.alignment=d.word,e.flatTypes=[_],e.LOW_VALUE=0,e.HIGH_VALUE=4294967295,e.valid=function(t){return t>=e.LOW_VALUE&&t<=e.HIGH_VALUE&&Number.isInteger(t)},e.load=function(e,t){return e.getUint32(t)},e.liftFlat=function(t,n){const r=n.next().value;if(r<e.LOW_VALUE||r>e.HIGH_VALUE||!Number.isInteger(r))throw new c(`Invalid u32 value ${r}`);return r},e.alloc=function(t){return t.alloc(e.alignment,e.size)},e.store=function(e,t,n){e.setUint32(t,n)},e.lowerFlat=function(t,n,r){if(r<e.LOW_VALUE||r>e.HIGH_VALUE||!Number.isInteger(r))throw new c(`Invalid u32 value ${r}`);t.push(r)},e.copy=function(t,n,r,o){t.assertAlignment(n,e.alignment),r.assertAlignment(o,e.alignment),r.copyBytes(o,e.size,t,n)},e.copyFlat=function(e,t,n,r){e.push(n.next().value)},e.Error=class extends ue{constructor(e){super(`Error value: ${e}`,e)}}}(E||(t.u32=E={})),z.satisfies(E),function(e){e.kind=O.u64,e.size=8,e.alignment=d.doubleWord,e.flatTypes=[x],e.LOW_VALUE=0n,e.HIGH_VALUE=18446744073709551615n,e.load=function(e,t){return e.getUint64(t)},e.liftFlat=function(t,n){const r=n.next().value;if(r<e.LOW_VALUE)throw new c(`Invalid u64 value ${r}`);return r},e.alloc=function(t){return t.alloc(e.alignment,e.size)},e.store=function(e,t,n){e.setUint64(t,n)},e.lowerFlat=function(t,n,r){if(r<e.LOW_VALUE)throw new c(`Invalid u64 value ${r}`);t.push(r)},e.copy=function(t,n,r,o){t.assertAlignment(n,e.alignment),r.assertAlignment(o,e.alignment),r.copyBytes(o,e.size,t,n)},e.copyFlat=function(e,t,n,r){e.push(n.next().value)},e.Error=class extends ue{constructor(e){super(`Error value: ${e}`,e)}}}(j||(t.u64=j={})),z.satisfies(j),function(e){e.kind=O.s8,e.size=1,e.alignment=d.byte,e.flatTypes=[_],e.load=function(e,t){return e.getInt8(t)},e.liftFlat=function(e,t){let n=t.next().value;if(!Number.isInteger(n))throw new c(`Invalid s8 value ${n}`);if(n>127&&(n-=256),n<-128||n>127)throw new c(`Invalid s8 value ${n}`);return n},e.alloc=function(t){return t.alloc(e.alignment,e.size)},e.store=function(e,t,n){e.setInt8(t,n)},e.lowerFlat=function(e,t,n){if(n<-128||n>127||!Number.isInteger(n))throw new c(`Invalid s8 value ${n}`);e.push(n<0?n+256:n)},e.copy=function(t,n,r,o){t.assertAlignment(n,e.alignment),r.assertAlignment(o,e.alignment),r.copyBytes(o,e.size,t,n)},e.copyFlat=function(e,t,n,r){e.push(n.next().value)},e.Error=class extends ue{constructor(e){super(`Error value: ${e}`,e)}}}(C||(t.s8=C={})),z.satisfies(C),function(e){e.kind=O.s16,e.size=2,e.alignment=d.halfWord,e.flatTypes=[_];const t=-32768,n=32767;e.load=function(e,t){return e.getInt16(t)},e.liftFlat=function(e,r){let o=r.next().value;if(!Number.isInteger(o))throw new c(`Invalid s16 value ${o}`);if(o>n&&(o-=65536),o<t||o>n)throw new c(`Invalid s16 value ${o}`);return o},e.alloc=function(t){return t.alloc(e.alignment,e.size)},e.store=function(e,t,n){e.setInt16(t,n)},e.lowerFlat=function(e,r,o){if(o<t||o>n||!Number.isInteger(o))throw new c(`Invalid s16 value ${o}`);e.push(o<0?o+65536:o)},e.copy=function(t,n,r,o){t.assertAlignment(n,e.alignment),r.assertAlignment(o,e.alignment),r.copyBytes(o,e.size,t,n)},e.copyFlat=function(e,t,n,r){e.push(n.next().value)},e.Error=class extends ue{constructor(e){super(`Error value: ${e}`,e)}}}(N||(t.s16=N={})),z.satisfies(N),function(e){e.kind=O.s32,e.size=4,e.alignment=d.word,e.flatTypes=[_];const t=-2147483648,n=2147483647;e.load=function(e,t){return e.getInt32(t)},e.liftFlat=function(e,r){let o=r.next().value;if(!Number.isInteger(o))throw new c(`Invalid s32 value ${o}`);if(o>n&&(o-=4294967296),o<t||o>n)throw new c(`Invalid s32 value ${o}`);return o},e.alloc=function(t){return t.alloc(e.alignment,e.size)},e.store=function(e,t,n){e.setInt32(t,n)},e.lowerFlat=function(e,r,o){if(o<t||o>n||!Number.isInteger(o))throw new c(`Invalid s32 value ${o}`);e.push(o<0?o+4294967296:o)},e.copy=function(t,n,r,o){t.assertAlignment(n,e.alignment),r.assertAlignment(o,e.alignment),r.copyBytes(o,e.size,t,n)},e.copyFlat=function(e,t,n,r){e.push(n.next().value)},e.Error=class extends ue{constructor(e){super(`Error value: ${e}`,e)}}}(k||(t.s32=k={})),z.satisfies(k),function(e){e.kind=O.s64,e.size=8,e.alignment=d.doubleWord,e.flatTypes=[x];const t=-9223372036854775808n,n=9223372036854775807n;e.load=function(e,t){return e.getInt64(t)},e.liftFlat=function(e,r){let o=r.next().value;if("bigint"!=typeof o)throw new c(`Invalid s64 value ${o}`);if(o>n&&(o-=18446744073709551616n),o<t||o>n)throw new c(`Invalid s64 value ${o}`);return o},e.alloc=function(t){return t.alloc(e.alignment,e.size)},e.store=function(e,t,n){e.setInt64(t,n)},e.lowerFlat=function(e,r,o){if(o<t||o>n)throw new c(`Invalid s64 value ${o}`);e.push(o<0?o+18446744073709551616n:o)},e.copy=function(t,n,r,o){t.assertAlignment(n,e.alignment),r.assertAlignment(o,e.alignment),r.copyBytes(o,e.size,t,n)},e.copyFlat=function(e,t,n,r){e.push(n.next().value)},e.Error=class extends ue{constructor(e){super(`Error value: ${e}`,e)}}}(W||(t.s64=W={})),z.satisfies(W),function(e){e.kind=O.float32,e.size=4,e.alignment=d.word,e.flatTypes=[$];const t=-34028234663852886e22,n=34028234663852886e22,r=2143289344;e.load=function(e,t){return e.getFloat32(t)},e.liftFlat=function(e,o){const i=o.next().value;if(i<t||i>n)throw new c(`Invalid float32 value ${i}`);return i===r?Number.NaN:i},e.alloc=function(t){return t.alloc(e.alignment,e.size)},e.store=function(e,t,n){e.setFloat32(t,n)},e.lowerFlat=function(e,o,i){if(i<t||i>n)throw new c(`Invalid float32 value ${i}`);e.push(Number.isNaN(i)?r:i)},e.copy=function(t,n,r,o){t.assertAlignment(n,e.alignment),r.assertAlignment(o,e.alignment),r.copyBytes(o,e.size,t,n)},e.copyFlat=function(e,t,n,r){e.push(n.next().value)},e.Error=class extends ue{constructor(e){super(`Error value: ${e}`,e)}}}(V||(t.float32=V={})),z.satisfies(V),function(e){e.kind=O.float64,e.size=8,e.alignment=d.doubleWord,e.flatTypes=[F];const t=-1*Number.MAX_VALUE,n=Number.MAX_VALUE,r=0x7ff8000000000000;e.load=function(e,t){return e.getFloat64(t)},e.liftFlat=function(e,o){const i=o.next().value;if(i<t||i>n)throw new c(`Invalid float64 value ${i}`);return i===r?Number.NaN:i},e.alloc=function(t){return t.alloc(e.alignment,e.size)},e.store=function(e,t,n){e.setFloat64(t,n)},e.lowerFlat=function(e,o,i){if(i<t||i>n)throw new c(`Invalid float64 value ${i}`);e.push(Number.isNaN(i)?r:i)},e.copy=function(t,n,r,o){t.assertAlignment(n,e.alignment),r.assertAlignment(o,e.alignment),r.copyBytes(o,e.size,t,n)},e.copyFlat=function(e,t,n,r){e.push(n.next().value)},e.Error=class extends ue{constructor(e){super(`Error value: ${e}`,e)}}}(S||(t.float64=S={})),z.satisfies(S),t.byte={kind:R.kind,size:R.size,alignment:R.alignment,flatTypes:R.flatTypes,load:R.load,liftFlat:R.liftFlat,alloc:R.alloc,store:R.store,lowerFlat:R.lowerFlat,copy:R.copy,copyFlat:R.copyFlat},t.size={kind:E.kind,size:E.size,alignment:E.alignment,flatTypes:E.flatTypes,load:E.load,liftFlat:E.liftFlat,alloc:E.alloc,store:E.store,lowerFlat:E.lowerFlat,copy:E.copy,copyFlat:E.copyFlat},t.ptr={kind:E.kind,size:E.size,alignment:E.alignment,flatTypes:E.flatTypes,load:E.load,liftFlat:E.liftFlat,alloc:E.alloc,store:E.store,lowerFlat:E.lowerFlat,copy:E.copy,copyFlat:E.copyFlat},function(e){function t(e){if(e>=1114112||55296<=e&&e<=57343)throw new c("Invalid code point");return String.fromCodePoint(e)}function n(e){if(1!==e.length)throw new c("String length must be 1");const t=e.codePointAt(0);if(!(t<=55295||55296<=t&&t<=1114111))throw new c("Invalid code point");return t}e.kind=O.char,e.size=4,e.alignment=d.word,e.flatTypes=[_],e.load=function(e,n,r){return t(E.load(e,n))},e.liftFlat=function(e,n,r){return t(E.liftFlat(e,n))},e.alloc=function(e){return E.alloc(e)},e.store=function(e,t,r,o){E.store(e,t,n(r))},e.lowerFlat=function(e,t,r,o){E.lowerFlat(e,t,n(r))},e.copy=function(t,n,r,o){t.assertAlignment(n,e.alignment),r.assertAlignment(o,e.alignment),r.copyBytes(o,e.size,t,n)},e.copyFlat=function(e,t,n,r){e.push(n.next().value)},e.Error=class extends ue{constructor(e){super(e,`Error value: ${e}`)}}}(B||(t.char=B={})),z.satisfies(B),function(e){function t(e,t){const n=t.encoding;if("latin1+utf-16"===n)throw new c("latin1+utf-16 encoding not yet supported");if("utf-8"===n)return[R.alignment,e];if("utf-16"===n)return[P.alignment,2*e];throw new c("Unsupported encoding")}function n(e,t,n,r){const o=r.encoding;if("latin1+utf-16"===o)throw new c("latin1+utf-16 encoding not yet supported");if("utf-8"===o){const r=n,o=e.readonly(t,r);return f.decode(o.getUint8Array(0,r))}if("utf-16"===o){const r=e.readonly(t,2*n);return String.fromCharCode(...r.getUint16Array(t,n))}throw new c("Unsupported encoding")}function r(e,t,n){const{encoding:r}=n;if("latin1+utf-16"===r)throw new c("latin1+utf-16 encoding not yet supported");if("utf-8"===r){const n=p.encode(t),r=e.alloc(R.alignment,n.length);return r.setUint8Array(0,n),[r.ptr,n.length]}if("utf-16"===r){const n=e.alloc(P.alignment,2*t.length),r=n.getUint16View(0);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return[n.ptr,r.length]}throw new c("Unsupported encoding")}e.kind=O.string,e.size=8,e.alignment=d.word,e.flatTypes=[_,_],e.load=function(e,t,r){const o=e.getUint32(t+0),i=e.getUint32(t+4);return n(e.memory,o,i,r.options)},e.liftFlat=function(e,t,r){return n(e,t.next().value,t.next().value,r.options)},e.alloc=function(t){return t.alloc(e.alignment,e.size)},e.store=function(e,t,n,o){const[i,s]=r(e.memory,n,o.options);e.setUint32(t+0,i),e.setUint32(t+4,s)},e.lowerFlat=function(e,t,n,o){e.push(...r(t,n,o.options))},e.copy=function(n,r,o,i,s){n.assertAlignment(r,e.alignment),o.assertAlignment(i,e.alignment);const a=o.getUint32(i+0),l=o.getUint32(i+4),[c,u]=t(l,s.options),f=o.memory.readonly(a,u),p=n.memory.alloc(c,u);f.copyBytes(0,u,p,0),n.setUint32(r+0,p.ptr),n.setUint32(r+4,l)},e.copyFlat=function(e,n,r,o,i){const s=r.next().value,a=r.next().value,[l,c]=t(a,i.options),u=o.readonly(s,c),f=n.alloc(l,c);u.copyBytes(0,c,f,0),e.push(f.ptr,a)},e.getAlignmentAndByteLength=t,e.Error=class extends ue{constructor(e){super(e,`Error value: ${e}`)}}}(L||(t.wstring=L={})),z.satisfies(L);class fe{static offsets={data:0,length:4};elementType;kind;size;alignment;flatTypes;constructor(e){this.elementType=e,this.kind=O.list,this.size=8,this.alignment=d.word,this.flatTypes=[_,_]}load(e,t,n){const r=fe.offsets,o=e.getUint32(t+r.data),i=e.getUint32(t+r.length);return this.loadFromRange(e.memory.readonly(o,i*this.elementType.size),i,n)}liftFlat(e,t,n){const r=t.next().value,o=t.next().value;return this.loadFromRange(e.readonly(r,o*this.elementType.size),o,n)}alloc(e){return e.alloc(this.alignment,this.size)}store(e,t,n,r){const o=e.memory.alloc(this.elementType.alignment,this.elementType.size*n.length);this.storeIntoRange(o,n,r);const i=fe.offsets;e.setUint32(t+i.data,o.ptr),e.setUint32(t+i.length,n.length)}lowerFlat(e,t,n,r){const o=t.alloc(this.elementType.alignment,this.elementType.size*n.length);this.storeIntoRange(o,n,r),e.push(o.ptr,n.length)}copy(e,t,n,r){e.assertAlignment(t,this.alignment),n.assertAlignment(r,this.alignment);const o=fe.offsets,i=n.getUint32(r+o.data),s=n.getUint32(r+o.length),a=s*this.elementType.size,l=n.memory.readonly(i,a),c=e.memory.alloc(this.elementType.alignment,a);l.copyBytes(0,a,c,0),e.setUint32(t+o.data,c.ptr),e.setUint32(t+o.length,s)}copyFlat(e,t,n,r,o){const i=n.next().value,s=n.next().value,a=s*this.elementType.size,l=r.readonly(i,a),c=t.alloc(this.elementType.alignment,a);l.copyBytes(0,a,c,0),e.push(c.ptr,s)}loadFromRange(e,t,n){const r=[];let o=0;for(let i=0;i<t;i++)r.push(this.elementType.load(e,o,n)),o+=this.elementType.size;return r}storeIntoRange(e,t,n){let r=0;for(const o of t)this.elementType.store(e,r,o,n),r+=this.elementType.size}}t.ListType=fe,function(e){e.Error=class extends ue{constructor(e){super(`Error value: ${JSON.stringify(e)}`,e)}}}(H||(t.list=H={}));class pe{static offsets={data:0,length:4};kind;size;alignment;flatTypes;elementType;constructor(e){this.kind=O.list,this.size=8,this.alignment=4,this.flatTypes=[_,_],this.elementType=e}load(e,t){const n=pe.offsets,r=e.getUint32(t+n.data),o=e.getUint32(t+n.length);return this.loadFromRange(e.memory.readonly(r,o*this.elementType.size),o)}liftFlat(e,t){const n=t.next().value,r=t.next().value;return this.loadFromRange(e.readonly(n,r*this.elementType.size),r)}alloc(e){return e.alloc(this.alignment,this.size)}store(e,t,n){const r=e.memory.alloc(this.elementType.alignment,n.byteLength);this.storeIntoRange(r,n);const o=pe.offsets;e.setUint32(t+o.data,r.ptr),e.setUint32(t+o.length,n.length)}lowerFlat(e,t,n){const r=t.alloc(this.elementType.alignment,n.byteLength);this.storeIntoRange(r,n),e.push(r.ptr,n.length)}copy(e,t,n,r){e.assertAlignment(t,this.alignment),n.assertAlignment(r,this.alignment);const o=pe.offsets;n.copyBytes(r,this.size,e,t);const i=n.getUint32(r+o.data),s=n.getUint32(r+o.length)*this.elementType.size,a=n.memory.readonly(i,s),l=e.memory.alloc(this.elementType.alignment,s);a.copyBytes(0,s,l,0)}copyFlat(e,t,n,r,o){const i=n.next().value,s=n.next().value,a=s*this.elementType.size,l=r.readonly(i,a),c=t.alloc(this.elementType.alignment,a);l.copyBytes(0,a,c,0),e.push(c.ptr,s)}}class de extends pe{constructor(){super(C)}loadFromRange(e,t){return e.getInt8Array(0,t)}storeIntoRange(e,t){e.setInt8Array(0,t)}}t.Int8ArrayType=de,function(e){e.Error=class extends ue{constructor(e){super(`Error value: ${JSON.stringify(e)}`,e)}}}(de||(t.Int8ArrayType=de={}));class ye extends pe{constructor(){super(N)}loadFromRange(e,t){return e.getInt16Array(0,t)}storeIntoRange(e,t){e.setInt16Array(0,t)}}t.Int16ArrayType=ye,function(e){e.Error=class extends ue{constructor(e){super(`Error value: ${JSON.stringify(e)}`,e)}}}(ye||(t.Int16ArrayType=ye={}));class he extends pe{constructor(){super(k)}loadFromRange(e,t){return e.getInt32Array(0,t)}storeIntoRange(e,t){e.setInt32Array(0,t)}}t.Int32ArrayType=he,function(e){e.Error=class extends ue{constructor(e){super(`Error value: ${JSON.stringify(e)}`,e)}}}(he||(t.Int32ArrayType=he={}));class me extends pe{constructor(){super(W)}loadFromRange(e,t){return e.getInt64Array(0,t)}storeIntoRange(e,t){e.setInt64Array(0,t)}}t.BigInt64ArrayType=me,function(e){e.Error=class extends ue{constructor(e){super(`Error value: ${JSON.stringify(e)}`,e)}}}(me||(t.BigInt64ArrayType=me={}));class ge extends pe{constructor(){super(R)}loadFromRange(e,t){return e.getUint8Array(0,t)}storeIntoRange(e,t){e.setUint8Array(0,t)}}t.Uint8ArrayType=ge,function(e){e.Error=class extends ue{constructor(e){super(`Error value: ${JSON.stringify(e)}`,e)}}}(ge||(t.Uint8ArrayType=ge={}));class we extends pe{constructor(){super(P)}loadFromRange(e,t){return e.getUint16Array(0,t)}storeIntoRange(e,t){e.setUint16Array(0,t)}}t.Uint16ArrayType=we,function(e){e.Error=class extends ue{constructor(e){super(`Error value: ${JSON.stringify(e)}`,e)}}}(we||(t.Uint16ArrayType=we={}));class ve extends pe{constructor(){super(E)}loadFromRange(e,t){return e.getUint32Array(0,t)}storeIntoRange(e,t){e.setUint32Array(0,t)}}t.Uint32ArrayType=ve,function(e){e.Error=class extends ue{constructor(e){super(`Error value: ${JSON.stringify(e)}`,e)}}}(ve||(t.Uint32ArrayType=ve={}));class be extends pe{constructor(){super(j)}loadFromRange(e,t){return e.getUint64Array(0,t)}storeIntoRange(e,t){e.setUint64Array(0,t)}}t.BigUint64ArrayType=be,function(e){e.Error=class extends ue{constructor(e){super(`Error value: ${JSON.stringify(e)}`,e)}}}(be||(t.BigUint64ArrayType=be={}));class Te extends pe{constructor(){super(V)}loadFromRange(e,t){return e.getFloat32Array(0,t)}storeIntoRange(e,t){e.setFloat32Array(0,t)}}t.Float32ArrayType=Te,function(e){e.Error=class extends ue{constructor(e){super(`Error value: ${JSON.stringify(e)}`,e)}}}(Te||(t.Float32ArrayType=Te={}));class Ae extends pe{constructor(){super(S)}loadFromRange(e,t){return e.getFloat64Array(0,t)}storeIntoRange(e,t){e.setFloat64Array(0,t)}}t.Float64ArrayType=Ae,function(e){e.Error=class extends ue{constructor(e){super(`Error value: ${JSON.stringify(e)}`,e)}}}(Ae||(t.Float64ArrayType=Ae={}));class _e{fields;kind;size;alignment;flatTypes;constructor(e,t){this.fields=e,this.kind=t,this.alignment=_e.alignment(e),this.size=_e.size(e,this.alignment),this.flatTypes=_e.flatTypes(e)}load(e,t,n){e.assertAlignment(t,this.alignment);const r=[];for(const o of this.fields)t=y(t,o.type.alignment),r.push(o.type.load(e,t,n)),t+=o.type.size;return this.create(this.fields,r)}liftFlat(e,t,n){const r=[];for(const o of this.fields)r.push(o.type.liftFlat(e,t,n));return this.create(this.fields,r)}alloc(e){return e.alloc(this.alignment,this.size)}store(e,t,n,r){e.assertAlignment(t,this.alignment);const o=this.elements(n,this.fields);for(let n=0;n<this.fields.length;n++){const i=this.fields[n],s=o[n];t=y(t,i.type.alignment),i.type.store(e,t,s,r),t+=i.type.size}}lowerFlat(e,t,n,r){const o=this.elements(n,this.fields);for(let n=0;n<this.fields.length;n++){const i=this.fields[n],s=o[n];i.type.lowerFlat(e,t,s,r)}}copy(e,t,n,r,o){for(const i of this.fields)t=y(t,i.type.alignment),r=y(r,i.type.alignment),i.type.copy(e,t,n,r,o),t+=i.type.size,r+=i.type.size}copyFlat(e,t,n,r,o){for(const i of this.fields)i.type.copyFlat(e,t,n,r,o)}static size(e,t){let n=0;for(const t of e)n=y(n,t.type.alignment),n+=t.type.size;return y(n,t)}static alignment(e){let t=1;for(const n of e)t=Math.max(t,n.type.alignment);return t}static flatTypes(e){const t=[];for(const n of e)t.push(...n.type.flatTypes);return t}}!function(e){e.create=function(e,t){return{name:e,type:t}}}(D||(D={})),t.RecordType=class extends _e{constructor(e){const t=[];for(const[n,r]of e)t.push(D.create(n,r));super(t,O.record)}create(e,t){const n={};for(let r=0;r<e.length;r++){const o=e[r],i=t[r];n[o.name]=i}return n}elements(e,t){const n=[];for(const r of t){const t=e[r.name];n.push(t)}return n}},function(e){e.create=function(e){return{type:e}}}(K||(K={}));class xe extends _e{constructor(e){const t=[];for(const n of e)t.push(K.create(n));super(t,O.tuple)}create(e,t){return t}elements(e,t){return e}}t.TupleType=xe,function(e){e.Error=class extends ue{constructor(e){super(`Error value: ${JSON.stringify(e)}`,e)}}}(G||(t.tuple=G={}));class $e{type;arraySize;kind;size;alignment;flatTypes;constructor(e){this.kind=O.flags,this.size=$e.size(e),this.alignment=$e.alignment(e),this.flatTypes=$e.flatTypes(e),this.type=$e.getType(e),this.arraySize=$e.num32Flags(e)}load(e,t,n){return void 0===this.type?0:this.loadFrom(this.type.load(e,t,n))}liftFlat(e,t,n){return void 0===this.type?0:this.loadFrom(this.type.liftFlat(e,t,n))}loadFrom(e){if("number"==typeof e)return e;{let t=0n;for(let n=0,r=e.length-1;n<e.length;n++,r--){const o=e[r];t|=BigInt(o)<<BigInt(32*n)}return t}}alloc(e){return e.alloc(this.alignment,this.size)}store(e,t,n,r){void 0!==this.type&&this.type.store(e,t,this.storeInto(n),r)}lowerFlat(e,t,n,r){void 0!==this.type&&this.type.lowerFlat(e,t,this.storeInto(n),r)}copy(e,t,n,r,o){void 0!==this.type&&this.type.copy(e,t,n,r,o)}copyFlat(e,t,n,r,o){void 0!==this.type&&this.type.copyFlat(e,t,n,r,o)}storeInto(e){if("number"==typeof e)return e;{const t=new Array(this.arraySize).fill(0);for(let n=0,r=t.length-1;n<t.length;n++,r--){const o=Number(e>>BigInt(32*n)&BigInt(4294967295));t[r]=o}return t}}static size(e){return 0===e?0:e<=8?1:e<=16?2:4*this.num32Flags(e)}static alignment(e){return e<=8?1:e<=16?2:4}static getType(e){return 0===e?void 0:e<=8?R:e<=16?P:e<=32?E:new xe(new Array(this.num32Flags(e)).fill(E))}static flatTypes(e){return new Array(this.num32Flags(e)).fill(_)}static num32Flags(e){return Math.ceil(e/32)}}t.FlagsType=$e,function(e){e.create=function(e,t,n){return{index:e,tag:t,type:n,wantFlatTypes:void 0!==n?[]:void 0}}}(J||(J={}));class Fe{cases;case2Index;ctor;discriminantType;maxCaseAlignment;kind;size;alignment;flatTypes;constructor(e,t,n=O.variant){const r=[];this.case2Index=new Map;for(let t=0;t<e.length;t++){const n=e[t][1],o=e[t][0];this.case2Index.set(o,t),r.push(J.create(t,o,n))}this.cases=r,this.ctor=t,this.discriminantType=Fe.discriminantType(r.length),this.maxCaseAlignment=Fe.maxCaseAlignment(r),this.kind=n,this.size=Fe.size(this.discriminantType,r),this.alignment=Fe.alignment(this.discriminantType,r),this.flatTypes=Fe.flatTypes(this.discriminantType,r)}load(e,t,n){const r=this.discriminantType.load(e,t),o=this.cases[r];if(void 0===o.type)return this.ctor(o.tag,void 0);{t+=this.discriminantType.size,t=y(t,this.maxCaseAlignment);const r=o.type.load(e,t,n);return this.ctor(o.tag,r)}}liftFlat(e,t,n){let r=this.flatTypes.length-1;const o=this.discriminantType.liftFlat(e,t),i=this.cases[o];let s;if(void 0===i.type)s=this.ctor(i.tag,void 0);else{const o=i.wantFlatTypes,a=new ce(t,this.flatTypes.slice(1),o),l=i.type.liftFlat(e,a,n);s=this.ctor(i.tag,l),r-=o.length}for(let e=0;e<r;e++)t.next();return s}alloc(e){return e.alloc(this.alignment,this.size)}store(e,t,n,r){const o=this.case2Index.get(n.tag);if(void 0===o)throw new c(`Variant case ${n.tag} not found`);this.discriminantType.store(e,t,o),t+=this.discriminantType.size;const i=this.cases[o];void 0!==i.type&&void 0!==n.value&&(t=y(t,this.maxCaseAlignment),i.type.store(e,t,n.value,r))}lowerFlat(e,t,n,r){const o=this.flatTypes,i=this.case2Index.get(n.tag);if(void 0===i)throw new c(`Variant case ${n.tag} not found`);this.discriminantType.lowerFlat(e,t,i);const s=this.cases[i];let a=this.flatTypes.length-1;if(void 0!==s.type&&void 0!==n.value){const i=[];s.type.lowerFlat(i,t,n.value,r);const l=o.slice(1),u=s.wantFlatTypes;if(i.length!==u.length)throw new c("Mismatched flat types");for(let e=0;e<l.length;e++){const t=u[e],n=l[e];t===$&&n===_?i[e]=M.reinterpret_f32_as_i32(i[e]):t===_&&n===x?i[e]=M.convert_i32_to_i64(i[e]):t===$&&n===x?i[e]=M.reinterpret_f32_as_i64(i[e]):t===F&&n===x&&(i[e]=M.reinterpret_f64_as_i64(i[e]))}a-=i.length,e.push(...i)}for(let t=o.length-a;t<o.length;t++)o[t]===x?e.push(0n):e.push(0)}copy(e,t,n,r,o){this.discriminantType.copy(e,t,n,r);const i=this.discriminantType.load(n,r),s=this.cases[i];void 0!==s.type&&(r+=this.discriminantType.size,r=y(r,this.maxCaseAlignment),t+=this.discriminantType.size,t=y(t,this.maxCaseAlignment),s.type.copy(e,t,n,r,o))}copyFlat(e,t,n,r,o){let i=this.flatTypes.length-1;this.discriminantType.copyFlat(e,t,n,r);const s=e[e.length-1],a=this.cases[s];if(void 0!==a.type){const s=a.wantFlatTypes,l=new ce(n,this.flatTypes.slice(1),s);a.type.copyFlat(e,t,l,r,o),i-=s.length}for(let t=0;t<i;t++)e.push(n.next().value)}static size(e,t){let n=e.size;return n=y(n,this.maxCaseAlignment(t)),n+this.maxCaseSize(t)}static alignment(e,t){return Math.max(e.alignment,this.maxCaseAlignment(t))}static flatTypes(e,t){const n=[];for(const e of t){if(void 0===e.type)continue;const t=e.type.flatTypes;for(let r=0;r<t.length;r++){const o=t[r];if(r<n.length){const t=this.joinFlatType(n[r],o);n[r]=t,e.wantFlatTypes.push(o)}else n.push(o),e.wantFlatTypes.push(o)}}return[...e.flatTypes,...n]}static discriminantType(e){switch(Math.ceil(Math.log2(e)/8)){case 0:case 1:return R;case 2:return P;case 3:return E}throw new c(`Too many cases: ${e}`)}static maxCaseAlignment(e){let t=1;for(const n of e)void 0!==n.type&&(t=Math.max(t,n.type.alignment));return t}static maxCaseSize(e){let t=0;for(const n of e)void 0!==n.type&&(t=Math.max(t,n.type.size));return t}static joinFlatType(e,t){return e===t?e:e===_&&t===$||e===$&&t===_?_:x}}t.VariantType=Fe;class Me{discriminantType;cases;case2index;kind;size;alignment;flatTypes;constructor(e){this.discriminantType=Me.discriminantType(e.length),this.cases=e,this.case2index=new Map;for(let t=0;t<e.length;t++){const n=e[t];this.case2index.set(n,t)}this.kind=O.enum,this.size=this.discriminantType.size,this.alignment=this.discriminantType.alignment,this.flatTypes=this.discriminantType.flatTypes}load(e,t,n){const r=this.assertRange(this.discriminantType.load(e,t,n));return this.cases[r]}liftFlat(e,t,n){const r=this.assertRange(this.discriminantType.liftFlat(e,t,n));return this.cases[r]}alloc(e){return e.alloc(this.alignment,this.size)}store(e,t,n,r){const o=this.case2index.get(n);if(void 0===o)throw new c("Enumeration value not found");this.discriminantType.store(e,t,o,r)}lowerFlat(e,t,n,r){const o=this.case2index.get(n);if(void 0===o)throw new c("Enumeration value not found");this.discriminantType.lowerFlat(e,t,o,r)}copy(e,t,n,r,o){this.discriminantType.copy(e,t,n,r,o)}copyFlat(e,t,n,r,o){this.discriminantType.copyFlat(e,t,n,r,o)}assertRange(e){if(e<0||e>this.cases.length)throw new c("Enumeration value out of range");return e}static discriminantType(e){switch(Math.ceil(Math.log2(e)/8)){case 0:case 1:return R;case 2:return P;case 3:return E}throw new c(`Too many cases: ${e}`)}}t.EnumType=Me,function(e){e.none="none",e.None=function(){return new t(e.none,void 0)},e.some="some",e.Some=function(n){return new t(e.some,n)},e._ctor=function(e,n){return new t(e,n)},e.isOption=function(e){return e instanceof t};class t{_tag;_value;constructor(e,t){this._tag=e,this._value=t}get tag(){return this._tag}get value(){return this._value}isNone(){return this._tag===e.none}isSome(){return this._tag===e.some}}e.Error=class extends ue{constructor(e){super(`Error value: ${JSON.stringify(e)}`,e)}}}(X||(t.option=X={})),t.OptionType=class{valueType;kind;size;alignment;flatTypes;constructor(e){this.valueType=e,this.kind=O.option,this.size=this.computeSize(),this.alignment=this.computeAlignment(),this.flatTypes=this.computeFlatTypes()}load(e,t,n){if(0===R.load(e,t))return n.options.keepOption?X._ctor(X.none,void 0):void 0;{t+=R.size,t=y(t,this.alignment);const r=this.valueType.load(e,t,n);return n.options.keepOption?X._ctor(X.some,r):r}}liftFlat(e,t,n){if(0===R.liftFlat(e,t)){for(let e=0;e<this.valueType.flatTypes.length;e++)t.next();return n.options.keepOption?X._ctor(X.none,void 0):void 0}{const r=this.valueType.liftFlat(e,t,n);return n.options.keepOption?X._ctor(X.some,r):r}}alloc(e){return e.alloc(this.alignment,this.size)}store(e,t,n,r){const o=this.asOptionValue(n,r.options),i=o.tag===X.none?0:1;R.store(e,t,i),t+=R.size,o.tag===X.some&&(t=y(t,this.valueType.alignment),this.valueType.store(e,t,o.value,r))}lowerFlat(e,t,n,r){const o=this.asOptionValue(n,r.options),i=o.tag===X.none?0:1;if(R.lowerFlat(e,t,i),o.tag===X.none)for(const t of this.valueType.flatTypes)t===x?e.push(0n):e.push(0);else this.valueType.lowerFlat(e,t,o.value,r)}copy(e,t,n,r,o){R.copy(e,t,n,r),0!==R.load(n,r)&&(r+=R.size,r=y(r,this.alignment),t+=R.size,t=y(t,this.alignment),this.valueType.copy(e,t,n,r,o))}copyFlat(e,t,n,r,o){if(R.copyFlat(e,t,n,r),0===e[e.length-1])for(const t of this.valueType.flatTypes)e.push(n.next().value);else this.valueType.copyFlat(e,t,n,r,o)}asOptionValue(e,t){if(X.isOption(e)){if(!t.keepOption)throw new c("Received an option value although options should be unpacked.");return e}if(t.keepOption)throw new c("Received a unpacked option value although options should NOT be unpacked.");return void 0===e?X._ctor(X.none,void 0):X._ctor(X.some,e)}computeSize(){let e=R.size;return e=y(e,this.valueType.alignment),e+this.valueType.size}computeAlignment(){return Math.max(R.alignment,this.valueType.alignment)}computeFlatTypes(){return[...R.flatTypes,...this.valueType.flatTypes]}},function(e){e.ok="ok",e.Ok=function(n){return new t(e.ok,n)},e.error="error",e.Error=function(n){return new t(e.error,n)},e._ctor=function(e,n){return new t(e,n)};class t{_tag;_value;constructor(e,t){this._tag=e,this._value=t}get tag(){return this._tag}get value(){return this._value}isOk(){return this._tag===e.ok}isError(){return this._tag===e.error}}e.ResultImpl=t}(Y||(t.result=Y={}));class Oe extends Fe{_errorClass;constructor(e,t,n){super([["ok",e],["error",t]],Y._ctor,O.result),this._errorClass=n}get errorClass(){return this._errorClass}}t.ResultType=Oe,function(e){e.Default=class{_handle;constructor(e){this._handle="number"==typeof e?e:e.registerResource(this)}$handle(){return this._handle}},e.getRepresentation=function(e){return"function"==typeof e.$rep?e.$rep():void 0}}(q||(t.Resource=q={})),function(e){e.handleTag=Symbol("handleTag"),e.Default=class{handleCounter;handleTable;h2r;finalizer;ctor;dtor;representationCounter;loopTable;constructor(){this.handleCounter=1,this.handleTable=new Map,this.h2r=new Map,this.finalizer=new FinalizationRegistry((e=>{const{handle:t,rep:n}=e;try{this.dtor(n)}catch(e){(0,l.default)().console.error(e)}this.h2r.delete(t),this.handleTable.delete(t),this.loopTable?.delete(n)})),this.representationCounter=Number.MAX_VALUE,this.loopTable=void 0}newHandle(e){const t=this.handleCounter++;return this.handleTable.set(t,e),t}getRepresentation(e){const t=this.handleTable.get(e);if(void 0===t)throw new c(`No representation registered for resource handle ${e}`);return t}dropHandle(e){const t=this.handleTable.get(e);if(void 0===t)throw new c(`Unknown resource handle ${e}`);return void 0!==this.dtor&&this.dtor(t),this.handleTable.delete(e),t}setProxyInfo(e,t){this.ctor=e,this.dtor=t}hasResource(e){return this.h2r.has(e)}getResource(t){const n=this.h2r.get(t);if(void 0!==n){if(n instanceof WeakRef){const e=n.deref();if(void 0===e)throw new c(`Resource for handle ${t} has been collected.`);return e}return n}const r=this.handleTable.get(t);if(void 0!==r){if(void 0===this.ctor)throw new c("No proxy constructor set");const n=new this.ctor(e.handleTag,t,r);return this.setProxy(t,r,n),n}throw new c(`Unknown resource handle ${t}`)}registerResource(e,t){if(void 0!==t){if(t>=this.handleCounter)throw new c(`Handle ${t} is out of bounds. Current handle counter is ${this.handleCounter}.`);if(this.h2r.has(t))throw new c(`Handle ${t} is already registered.`);if(this.handleTable.has(t))throw new c(`Handle ${t} is already in use as a proxy handle.`)}else t=this.handleCounter++;return this.h2r.set(t,e),t}registerProxy(e){const t=e.$handle(),n=q.getRepresentation(e)??this.handleTable.get(t);if(void 0===n)throw new c(`Unknown proxy handle ${t}`);this.setProxy(t,n,e)}removeResource(e){const t="number"==typeof e?e:e.$handle(),n=this.h2r.get(t);if(void 0===n)throw new c(`Unknown resource handle ${t}.`);if(n instanceof WeakRef)throw new c("Proxy resources should not be removed manually. They are removed via the GC.");this.h2r.delete(t)}registerLoop(e){void 0===this.loopTable&&(this.loopTable=new Map);const t=this.handleCounter++,n=this.representationCounter--;return this.handleTable.set(t,n),this.loopTable.set(n,e),t}getLoop(e){const t=this.loopTable?.get(e);if(void 0===t)throw new c(`Unknown loop handle for representation ${e}`);return t}setProxy(e,t,n){if(void 0===this.dtor)throw new c("No proxy destructor set");this.h2r.set(e,new WeakRef(n)),this.finalizer.register(n,{handle:e,rep:t},n)}},e.from=function(e){if(void 0!==e)return e.$resources??e.$resourceManager??e.$manager}}(Q||(t.ResourceManager=Q={})),function(e){e.Default=class{managers;constructor(){this.managers=new Map}has(e){return this.managers.has(e)}set(e,t){if(this.managers.has(e))throw new c(`Resource manager ${e} already registered.`);this.managers.set(e,t)}ensure(e){const t=this.managers.get(e);if(void 0===t)throw new c(`Resource manager ${e} not found.`);return t}get(e){return this.managers.get(e)}},e.is=function(e){const t=e;return t&&"function"==typeof t.has&&"function"==typeof t.ensure&&"function"==typeof t.get&&"function"==typeof t.set}}(Z||(t.ResourceManagers=Z={}));class Ie{static EMPTY_JTYPE=Object.freeze([]);static EMPTY_WASM_TYPE=Object.freeze([]);static MAX_FLAT_PARAMS=16;static MAX_FLAT_RESULTS=1;witName;params;returnType;paramType;isSingleParam;mode;constructor(e,t,n){switch(this.witName=e,this.params=t,this.returnType=n,t.length){case 0:this.paramType=void 0,this.isSingleParam=!1;break;case 1:this.paramType=t[0][1],this.isSingleParam=!0;break;default:this.paramType=new xe(t.map((e=>e[1]))),this.isSingleParam=!1}this.mode="lower"}liftParamValues(e,t,n){if(void 0===this.paramType)return Ie.EMPTY_JTYPE;let r;if(this.paramType.flatTypes.length>Ie.MAX_FLAT_PARAMS){const o=e[0];if(!Number.isInteger(o))throw new c("Invalid pointer");r=this.paramType.load(t.readonly(o,this.paramType.size),0,n)}else r=this.paramType.liftFlat(t,e.values(),n);return this.isSingleParam?[r]:r}lowerParamValues(e,t,n){if(void 0===this.paramType)return Ie.EMPTY_WASM_TYPE;if(this.isSingleParam&&1!==e.length)throw new c(`Expected a single parameter, but got ${e.length}`);const r=this.isSingleParam?e[0]:e;if(this.paramType.flatTypes.length>Ie.MAX_FLAT_PARAMS){const e=this.paramType.alloc(t);return this.paramType.store(e,0,r,n),[e.ptr]}{const e=[];return this.paramType.lowerFlat(e,t,r,n),e}}copyParamValues(e,t,n,r,o){const i=void 0!==this.returnType?this.returnType.flatTypes.length:0,s=void 0!==this.paramType?this.paramType.flatTypes.length:0;let a;if(i>Ie.MAX_FLAT_RESULTS&&n.length===s+1){const e=n[s];if(!Number.isInteger(e))throw new c(`Expected a pointer as return parameter, but got ${e}`);a=e}if(void 0===this.paramType){if(void 0===a&&0!==n.length||void 0!==a&&1!==n.length)throw new c(`Expected no parameters, but got ${n.length}`)}else if(this.paramType.flatTypes.length>Ie.MAX_FLAT_PARAMS){const e=n[0];if(!Number.isInteger(e))throw new c("Invalid pointer");const i=r.readonly(e,this.paramType.size);this.paramType.copy(this.paramType.alloc(t),0,i,0,o)}else this.paramType.copyFlat(e,t,n.values(),r,o);if(void 0!==a&&void 0!==this.returnType){const n=this.returnType.alloc(t);return e.push(n.ptr),{transferResult:n,originalResult:r.preAllocated(a,this.returnType.size)}}}lowerReturnValue(e,t,n,r){if(void 0!==this.returnType){if(this.returnType.flatTypes.length<=Ie.MAX_FLAT_RESULTS){const r=[];if(this.returnType.lowerFlat(r,t,e,n),r.length!==this.returnType.flatTypes.length)throw new c(`Expected flat result of length ${this.returnType.flatTypes.length}, but got ${JSON.stringify(r,void 0,void 0)}`);return r[0]}{const o=void 0!==r?t.preAllocated(r,this.returnType.size):this.returnType.alloc(t);return this.returnType.store(o,0,e,n),void 0!==r?void 0:o.ptr}}}handleError(e,t,n,r){if(!(this.returnType instanceof Oe&&void 0!==this.returnType.errorClass&&e instanceof this.returnType.errorClass))throw e;const o=Y.Error(e.cause);return this.lowerReturnValue(o,t,n,r)}copyReturnValue(e,t,n,r,o){if(void 0===e){if(void 0!==r){if(void 0===this.returnType)throw new c(`Expected no return value, but got ${r}`);if(this.returnType.flatTypes.length>Ie.MAX_FLAT_RESULTS){if(!Number.isInteger(r))throw new c(`Expected a pointer as return value, but got ${r}`);const e=this.returnType.alloc(t);return this.returnType.copy(e,0,n.preAllocated(r,this.returnType.size),0,o),e.ptr}return r}}else{if(void 0===this.returnType)throw new c("Result storage should not be set if there is no return type.");if(void 0!==r)throw new c(`Can't use both result storage and result value ${r}.`);this.returnType.copy(e.originalResult,0,e.transferResult,0,o)}}callWasm(e,t,n){const r=n.getMemory(),o=t(...this.lowerParamValues(e,r,n));return this.liftReturnValue(o,r,n)}callWasmMethod(e,t,n,r){const o=r.getMemory(),i=n(e.$rep(),...this.lowerParamValues(t,o,r));return this.liftReturnValue(i,o,r)}callMain(e,t,n,r){e.prepareCall();const o=[],i=this.copyParamValues(o,e.getMemory(),n,r.getMemory(),r),s=e.callMain(`${t}#${this.witName}`,o);return this.copyReturnValue(i,r.getMemory(),e.getMemory(),s,r)}callWasmFromWorker(e,t,n,r){const o=[],i=this.copyParamValues(o,r.getMemory(),n,e,r),s=t(...o);return this.copyReturnValue(i,e,r.getMemory(),s,r)}callWasmMethodFromWorker(e,t,n,r){const o=n[0];if("number"!=typeof o)throw new c(`Expected a number as handle, but got ${o}`);const i=[],s=this.copyParamValues(i,r.getMemory(),n.slice(1),e,r),a=t(o,...i);return this.copyReturnValue(s,e,r.getMemory(),a,r)}async callWorker(e,t,n,r){return e.lock((async()=>{e.prepareCall();const o=e.getMemory(),i=this.lowerParamValues(n,o,r);let s=await e.callWorker(`${t}#${this.witName}`,i);return this.liftReturnValue(s,o,r)}))}async callWorkerMethod(e,t,n,r,o){return e.lock((async()=>{e.prepareCall();const i=e.getMemory(),s=n.$rep(),a=this.lowerParamValues(r,i,o).slice();a.unshift(s);const l=await e.callWorker(`${t}#${this.witName}`,a);return this.liftReturnValue(l,i,o)}))}getParamValuesForHostCall(e,t,n){let r;if((void 0===this.returnType?0:this.returnType.flatTypes.length)>ze.MAX_FLAT_RESULTS){const t=void 0!==this.paramType?this.paramType.flatTypes.length:0;if(e.length===t+1){const n=e[t];if("number"!=typeof n)throw new c(`Result pointer must be a number (u32), but got ${r}.`);r=n}}return[this.liftParamValues(e,t,n),r]}liftReturnValue(e,t,n){if(void 0===this.returnType)return;let r;if(r=this.returnType.flatTypes.length<=Ie.MAX_FLAT_RESULTS?this.returnType.liftFlat(t,[e].values(),n):this.returnType.load(t.readonly(e,this.returnType.size),0,n),this.returnType instanceof Oe){const e=r;if(e.isError()){if(void 0===this.returnType.errorClass)throw new c("Received an error result, but no error class is defined.");throw new this.returnType.errorClass(e.value)}return e.value}return r}}class ze extends Ie{constructor(e,t,n){super(e,t,n)}callService(e,t,n){const[r,o]=this.getParamValuesForHostCall(t,n.getMemory(),n);try{const t=e(...r);return this.lowerReturnValue(t,n.getMemory(),n,o)}catch(e){return this.handleError(e,n.getMemory(),n,o)}}async callServiceAsync(e,t,n,r){const[o,i]=this.getParamValuesForHostCall(n,e,r);try{const n=await t(...o);return this.lowerReturnValue(n,e,r,i)}catch(t){return this.handleError(t,e,r,i)}}}t.FunctionType=ze;class Ue extends Ie{constructor(e,t,n){super(e,t,n)}callService(e,t,n){const r=void 0===this.returnType?0:this.returnType.flatTypes.length;if(1!==r)throw new c(`Expected exactly one return type, but got ${r}.`);const o=n.getMemory();return new e(...this.liftParamValues(t,o,n)).$handle()}async callServiceAsync(e,t,n,r){const o=void 0===this.returnType?0:this.returnType.flatTypes.length;if(1!==o)throw new c(`Expected exactly one return type, but got ${o}.`);const i=this.liftParamValues(n,e,r);return(await t.$new(...i)).$handle()}callWasmConstructor(e,t,n){const r=n.getMemory(),o=t(...this.lowerParamValues(e,r,n));if("number"!=typeof o)throw new c(`Expected a number (u32) as return value, but got ${o}.`);return o}callWasmConstructorAsync(e,t,n,r){return e.lock((async()=>{e.prepareCall();const o=e.getMemory(),i=this.lowerParamValues(n,o,r);return e.callWorker(`${t}#${this.witName}`,i)}))}}t.ConstructorType=Ue;class Re extends Ie{constructor(e,t){super(e,t)}callService(e,t){const n=e[0];if("bigint"==typeof n||!E.valid(n))throw new c(`Object handle must be a number (u32), but got ${n}.`);const r=t.getResource(n);void 0!==r.$drop&&r.$drop(),t.removeResource(n)}async callServiceAsync(e,t,n){const r=t[0];if("bigint"==typeof r||!E.valid(r))throw new c(`Object handle must be a number (u32), but got ${r}.`);const o=n.getResource(r);void 0!==o.$drop&&await o.$drop(),n.removeResource(r)}}t.DestructorType=Re;class Pe extends Ie{constructor(e,t,n){super(e,t,n)}callService(e,t,n){const[r,o]=this.getParamValuesForHostCall(t,n.getMemory(),n);try{const t=e(...r);return this.lowerReturnValue(t,n.getMemory(),n,o)}catch(e){return this.handleError(e,n.getMemory(),n,o)}}async callServiceAsync(e,t,n,r){const[o,i]=this.getParamValuesForHostCall(n,e,r);try{const n=await t(...o);return this.lowerReturnValue(n,e,r,i)}catch(t){return this.handleError(t,e,r,i)}}}t.StaticMethodType=Pe;class Ee extends Ie{constructor(e,t,n){super(e,t,n)}callService(e,t,n,r){if(0===t.length)throw new c("Method calls must have at least one parameter (the object pointer).");const o=t.shift();if("number"!=typeof o)throw new c(`Object handle must be a number (u32), but got ${o}.`);const[i,s]=this.getParamValuesForHostCall(t,r.getMemory(),r),a=n.getResource(o),l=r.getMemory();try{const t=a[e](...i);return this.lowerReturnValue(t,l,r,s)}catch(e){return this.handleError(e,l,r,s)}}async callServiceAsync(e,t,n,r,o){if(0===n.length)throw new c("Method calls must have at least one parameter (the object pointer).");const i=n.shift();if("number"!=typeof i)throw new c(`Object handle must be a number (u32), but got ${i}.`);const[s,a]=this.getParamValuesForHostCall(n,e,o),l=r.getResource(i);try{const n=await l[t](...s);return this.lowerReturnValue(n,e,o,a)}catch(t){return this.handleError(t,e,o,a)}}}t.MethodType=Ee,t.ResourceHandleType=class{kind;size;alignment;flatTypes;witName;constructor(e){this.witName=e,this.kind=O.resourceHandle,this.size=E.size,this.alignment=E.alignment,this.flatTypes=E.flatTypes}load(e,t){return E.load(e,t)}liftFlat(e,t){return E.liftFlat(e,t)}alloc(e){return E.alloc(e)}store(e,t,n){E.store(e,t,n)}lowerFlat(e,t,n){E.lowerFlat(e,t,n)}copy(e,t,n,r){E.copy(e,t,n,r)}copyFlat(e,t,n,r){E.copyFlat(e,t,n,r)}},t.ResourceType=class{kind;size;alignment;flatTypes;witName;id;callables;constructor(e,t){this.kind=O.resource,this.size=E.size,this.alignment=E.alignment,this.flatTypes=E.flatTypes,this.witName=e,this.id=t,this.callables=new Map}addConstructor(e,t){this.callables.set(e,t)}addDestructor(e,t){this.callables.set(e,t)}addStaticMethod(e,t){this.callables.set(e,t)}addMethod(e,t){this.callables.set(e,t)}getCallable(e){const t=this.callables.get(e);if(void 0===t)throw new c(`Method '${e}' not found on resource '${this.witName}'.`);return t}load(e,t,n){const r=E.load(e,t);return n.resources.ensure(this.id).getResource(r)}liftFlat(e,t,n){const r=E.liftFlat(e,t);return n.resources.ensure(this.id).getResource(r)}alloc(e){return E.alloc(e)}store(e,t,n){const r=n.$handle();E.store(e,t,r)}lowerFlat(e,t,n){const r=n.$handle();E.lowerFlat(e,t,r)}copy(e,t,n,r){E.copy(e,t,n,r)}copyFlat(e,t,n,r){E.copyFlat(e,t,n,r)}};class je{kind;size;alignment;flatTypes;wrapped;constructor(e,t){this.kind=e,this.wrapped=t,this.size=E.size,this.alignment=E.alignment,this.flatTypes=E.flatTypes}load(e,t,n){return this.wrapped.load(e,t,n)}liftFlat(e,t,n){return this.wrapped.liftFlat(e,t,n)}alloc(e){return E.alloc(e)}store(e,t,n,r){return this.wrapped.store(e,t,n,r)}lowerFlat(e,t,n,r){return this.wrapped.lowerFlat(e,t,n,r)}copy(e,t,n,r,o){return this.wrapped.copy(e,t,n,r,o)}copyFlat(e,t,n,r,o){return this.wrapped.copyFlat(e,t,n,r,o)}}function Ce(e,t,n){let r;return n.resources.has(e.id)?r=n.resources.ensure(e.id):(r=Q.from(t)??new Q.Default,n.resources.set(e.id,r)),r}t.BorrowType=class extends je{constructor(e){super(O.borrow,e)}},t.OwnType=class extends je{constructor(e){super(O.own,e)}},function(e){e.is=function(e){return"object"==typeof e&&"string"==typeof e.id&&"string"==typeof e.witName&&e.types instanceof Map&&e.functions instanceof Map&&e.resources instanceof Map}}(ee||(t.InterfaceType=ee={})),function(e){e.is=function(e){return"object"==typeof e&&"string"==typeof e.id&&"string"==typeof e.witName&&e.interfaces instanceof Map}}(te||(t.PackageType=te={})),function(e){e.Default=class{memory;options;resources;constructor(e,t){this.options=e??{encoding:"utf-8"},this.resources=t??new Z.Default}initialize(e){if(void 0!==this.memory)throw new h("Memory is already initialized.");this.memory=e}getMemory(){if(void 0===this.memory)throw new h("Memory not yet initialized.");return this.memory}},e.is=function(e){const t=e;return t&&"function"==typeof t.getMemory&&T.is(t.options)&&Z.is(t.resources)}}(ne||(t.WasmContext=ne={})),function(e){function t(e,t,r){const o=e.id.substring(0,e.id.indexOf("/")),i=Object.create(null);if(void 0!==e.imports&&(void 0!==e.imports.functions&&(i.$root=n(e.imports.functions,void 0,t,r)),void 0!==e.imports.interfaces))for(const[s,a]of e.imports.interfaces){const e=`${s[0].toLowerCase()}${s.substring(1)}`;i[`${o}/${a.witName}`]=n(a.functions,a.resources,t[e],r)}if(void 0!==e.exports&&void 0!==e.exports.interfaces)for(const t of e.exports.interfaces.values())if(void 0!==t.resources)for(const e of t.resources.values()){const n=Ce(e,void 0,r),s=Object.create(null);s[`[resource-new]${e.witName}`]=e=>n.newHandle(e),s[`[resource-rep]${e.witName}`]=e=>n.getRepresentation(e),s[`[resource-drop]${e.witName}`]=e=>n.dropHandle(e),i[`[export]${o}/${t.witName}`]=s}return i}function n(e,t,n,l){const c=Object.create(null);if(void 0!==e)for(const[t,o]of e)c[o.witName]=r(o,n[t],l);if(void 0!==t)for(const[e,r]of t){const t=n[e],u=Ce(r,t,l);for(const[f,p]of r.callables)p instanceof Ue?c[p.witName]=o(p,t,l):p instanceof Pe?c[p.witName]=s(p,n[e][f],l):p instanceof Ee?c[p.witName]=a(f,p,u,l):p instanceof Re&&(c[p.witName]=i(p,u))}return c}function r(e,t,n){return function(...r){return e.callService(t,r,n)}}function o(e,t,n){return function(...r){return e.callService(t,r,n)}}function i(e,t){return function(...n){return e.callService(n,t)}}function s(e,t,n){return function(...r){return e.callService(t,r,n)}}function a(e,t,n,r){return function(...o){return t.callService(e,o,n,r)}}let l;e.create=t,e.loop=function(e,n,r){const o=function(e,t){const n=Object.create(null),r=Object.keys(e);for(const o of r){const r=e[o];if(!o.startsWith("[export]"))if("$root"===o)for(const e of Object.keys(r))n[e]=r[e];else{const e=`${o}#`;for(const i of Object.keys(r))if(i.startsWith("[constructor]")){const s=`${o}/${i.substring(13)}`,a=t.resources.ensure(s);n[`${e}${i}`]=(...e)=>{const t=r[i](...e);return a.registerLoop(t)}}else if(i.startsWith("[method]")){let s=i.substring(8);-1!==s.indexOf(".")&&(s=s.substring(0,s.indexOf(".")));const a=`${o}/${s}`,l=t.resources.ensure(a);n[`${e}${i}`]=(e,...t)=>r[i](l.getLoop(e),...t)}else i.startsWith("[resource-drop]")?n[`${e}[dtor]${i.substring(15)}`]=r[i]:n[`${e}${i}`]=r[i]}}return n}(t(e,n,r),r),i={id:e.id,witName:e.witName,imports:void 0!==e.exports?{functions:e.exports.functions,interfaces:e.exports.interfaces}:void 0,exports:void 0!==e.imports?{functions:e.imports.functions,interfaces:e.imports.interfaces}:void 0};return oe.bind(i,o,r)},function(e){function t(e,t,n,r,o){const i=Object.create(null);if(void 0!==n)for(const[,r]of n)i[r.witName]=function(...n){return r.callMain(e,t,n,o)};if(void 0!==r)for(const n of r.values())for(const r of n.callables.values())i[r.witName]=function(...n){return r.callMain(e,t,n,o)};return i}e.create=function(e,n,r){const o=n.id.substring(0,n.id.indexOf("/")),i=Object.create(null);if(void 0!==n.imports&&(void 0!==n.imports.functions&&(i.$root=t(e,"$root",n.imports.functions,void 0,r)),void 0!==n.imports.interfaces))for(const s of n.imports.interfaces.values()){const n=`${o}/${s.witName}`;i[n]=t(e,n,s.functions,s.resources,r)}if(void 0!==n.exports&&void 0!==n.exports.interfaces)for(const t of n.exports.interfaces.values())if(void 0!==t.resources)for(const n of t.resources.values()){const r=Object.create(null),s=`[export]${o}/${t.witName}`,a=`[resource-new]${n.witName}`;r[a]=t=>e.callMain(`${s}#${a}`,[t]);const l=`[resource-rep]${n.witName}`;r[l]=t=>e.callMain(`${s}#${l}`,[t]);const c=`[resource-drop]${n.witName}`;r[c]=t=>e.callMain(`${s}#${c}`,[t]),i[s]=r}return i}}(l=e.worker||(e.worker={}))}(re||(t.$imports=re={})),function(e){function t(e){const t=Object.create(null),n=Object.create(null);for(const[r,o]of Object.entries(e)){const e=r.split("#");if(1===e.length)t[r]=o;else{const[t,r]=e;void 0===n[t]&&(n[t]=Object.create(null)),n[t][r]=o}}return[t,n]}function n(e,t,n,o){const i=Object.create(null);if(void 0!==e)for(const[t,s]of e)i[t]=r(s,n[s.witName],o);if(void 0!==t)for(const[e,r]of t){const t=Ce(r,void 0,o),s=ie.create(r,n,o);t.setProxyInfo(s,n[`[dtor]${r.witName}`]),i[e]=s}return i}function r(e,t,n){return(...r)=>e.callWasm(r,t,n)}let o;e.bind=function(e,r,o){const[i,s]=t(r),a=Object.create(null);if(void 0!==e.exports&&(void 0!==e.exports.functions&&Object.assign(a,n(e.exports.functions,void 0,i,o)),void 0!==e.exports.interfaces))for(const[t,r]of e.exports.interfaces)a[`${t[0].toLowerCase()}${t.substring(1)}`]=n(r.functions,r.resources,s[r.id],o);return a},function(e){function n(e,t,n,r,o,i){if(void 0!==n)for(const r of n.values())e.on(`${t}#${r.witName}`,((e,t)=>r.callWasmFromWorker(e,o[r.witName],t,i)));if(void 0!==r)for(const n of r.values())for(const r of n.callables.values())r instanceof Ue||r instanceof Pe?e.on(`${t}#${r.witName}`,((e,t)=>r.callWasmFromWorker(e,o[r.witName],t,i))):e.on(`${t}#${r.witName}`,((e,t)=>r.callWasmMethodFromWorker(e,o[r.witName],t,i)))}e.bind=function(e,r,o,i){const s=r.id.substring(0,r.id.indexOf("/")),[a,l]=t(o);if(void 0!==r.exports&&(n(e,s,r.exports.functions,void 0,a,i),void 0!==r.exports.interfaces))for(const t of r.exports.interfaces.values())n(e,`${s}/${t.witName}`,t.functions,t.resources,l[t.id],i)}}(o=e.worker||(e.worker={}))}(oe||(t.$exports=oe={})),(se=ie||(ie={})).create=function(e,t,n){let r;n.resources.has(e.id)?r=n.resources.ensure(e.id):(r=new Q.Default,n.resources.set(e.id,r));const o=class extends q.Default{_rep;constructor(...o){if(o[0]===Q.handleTag)super(o[1]),this._rep=o[2];else{const i=e.getCallable("constructor");super(i.callWasmConstructor(o,t[i.witName],n)),this._rep=r.getRepresentation(this.$handle())}}$rep(){return this._rep}};for(const[r,i]of e.callables)i instanceof Ee||i instanceof Re?o.prototype[r]=function(...e){return i.callWasmMethod(this,e,t[i.witName],n)}:i instanceof Pe&&(o[r]=(...e)=>i.callWasm(e,t[i.witName],n));return o},se.createPromise=function(e,t,n,r){let o;r.resources.has(n.id)?o=r.resources.ensure(n.id):(o=new Q.Default,r.resources.set(n.id,o));const i=class extends q.Default{_rep;static async $new(...s){const a=n.getCallable("constructor"),l=await a.callWasmConstructorAsync(e,t,s,r);return new i(Q.handleTag,l,o.getRepresentation(l))}constructor(e,t,n){super(t),this._rep=n}$rep(){return this._rep}};for(const[o,s]of n.callables)s instanceof Ee||s instanceof Re?i.prototype[o]=function(...n){return s.callWorkerMethod(e,t,this,n,r)}:s instanceof Pe&&(i[o]=(...n)=>s.callWorker(e,t,n,r));return i},function(e){async function t(e,t,n,r){const o=void 0!==r?new ne.Default(r.options,r.resources):new ne.Default;let i,s;void 0!==n.module?(i=n.module,s=n.memory):i=n;const a=re.create(e,t,o);void 0!==s&&(a.env.memory=s);const c=await(0,l.default)().WebAssembly.instantiate(i,a);return o.initialize(new b.Default(c.exports)),oe.bind(e,c.exports,o)}function n(e,t,n,r,o,i){if(void 0!==n)for(const[r,s]of n)e.on(`${t}#${s.witName}`,((e,t)=>s.callServiceAsync(e,o[r],t,i)));if(void 0!==r)for(const[n,s]of r){const r=o[n],a=Ce(s,r,i);for(const[l,c]of s.callables)c instanceof Ue?e.on(`${t}#${c.witName}`,((e,t)=>c.callServiceAsync(e,r,t,i))):c instanceof Pe?e.on(`${t}#${c.witName}`,((e,t)=>c.callServiceAsync(e,o[n][l],t,i))):c instanceof Ee?e.on(`${t}#${c.witName}`,((e,t)=>c.callServiceAsync(e,l,t,a,i))):c instanceof Re&&e.on(`${t}#${c.witName}`,((e,t)=>c.callServiceAsync(e,t,a)))}}function r(e,t,n,r,o){const i=Object.create(null);if(void 0!==n)for(const[r,s]of n)i[r]=(...n)=>s.callWorker(e,t,n,o);if(void 0!==r)for(const[n,s]of r){const r=Ce(s,void 0,o),a=ie.createPromise(e,t,s,o);r.setProxyInfo(a,(n=>{e.callWorker(`${t}#[dtor]${s.witName}`,[n]).catch((()=>{(0,l.default)().console.error(`Failed to call destructor for ${s.witName}`)}))})),i[n]=a}return i}e.bind=function(e,o,i,s,a){return void 0===s?t(e,o,i,new ne.Default):I.is(s)?t(e,o,i,s):async function(e,t,o,i,s){const a=await(0,l.default)().Connection.createMain(i);return a.listen(),await a.initialize(o,s.options),function(e,t,r,o){const i=t.id.substring(0,t.id.indexOf("/"));if(void 0!==t.imports&&(void 0!==t.imports.functions&&n(e,"$root",t.imports.functions,void 0,r,o),void 0!==t.imports.interfaces))for(const[s,a]of t.imports.interfaces){const t=`${s[0].toLowerCase()}${s.substring(1)}`;n(e,`${i}/${a.witName}`,a.functions,a.resources,r[t],o)}if(void 0!==t.exports&&void 0!==t.exports.interfaces)for(const n of t.exports.interfaces.values()){if(void 0===n.resources)continue;const t=`[export]${i}/${n.witName}`;for(const r of n.resources.values()){const n=Ce(r,void 0,o);e.on(`${t}#[resource-new]${r.witName}`,((e,t)=>n.newHandle(t[0]))),e.on(`${t}#[resource-rep]${r.witName}`,((e,t)=>n.getRepresentation(t[0]))),e.on(`${t}#[resource-drop]${r.witName}`,((e,t)=>n.dropHandle(t[0])))}}}(a,e,t,s),function(e,t,n){const o=t.id.substring(0,t.id.indexOf("/")),i=Object.create(null);if(void 0!==t.exports&&(void 0!==t.exports.functions&&Object.assign(i,r(e,o,t.exports.functions,void 0,n)),void 0!==t.exports.interfaces))for(const[s,a]of t.exports.interfaces)i[`${s[0].toLowerCase()}${s.substring(1)}`]=r(e,`${o}/${a.witName}`,a.functions,a.resources,n);return i}(a,e,s)}(e,o,i,s,a??{options:{encoding:"utf-8"},resources:new Z.Default})}}(ae||(t.$main=ae={}))},842:function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return o(t,e),t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.BaseMainConnection=t.BaseWorkerConnection=t.Connection=void 0;const a=i(n(899)),l=n(190),c=n(696),u=s(n(927)),f=n(534);class p{static Header={sync:{offset:0,size:4},errorCode:{offset:4,size:4},resultType:{offset:8,size:4},result:{offset:12,size:8},next:{offset:20,size:4},end:{offset:24,size:0}};buffer;id;next;constructor(e,t){void 0===e&&(e=65536),"number"==typeof e?(this.id=a.v4(),this.buffer=new SharedArrayBuffer(e),this.next=new Uint32Array(this.buffer,p.Header.next.offset,1),this.next[0]=p.Header.end.offset):(this.buffer=e,this.id=t,this.next=new Uint32Array(this.buffer,p.Header.next.offset,1))}reset(){new Uint8Array(this.buffer,0,p.Header.end.offset).fill(0),this.next[0]=p.Header.end.offset}alloc(e,t){const n=this.next[0],r=l.Alignment.align(n,e);return this.next[0]=r+t,new l.MemoryRange(this,r,t)}realloc(){throw new l.ComponentModelTrap("ConnectionMemory does not support realloc")}preAllocated(e,t){return new l.MemoryRange(this,e,t)}readonly(e,t){return new l.ReadonlyMemoryRange(this,e,t)}}class d{static createWorker(e,t,n){return(0,u.default)().Connection.createWorker(t,e,n)}memory;constructor(e){this.memory=e}static serializeParams(e){const t=[];for(const n of e)"number"==typeof n?t.push(n):t.push(n.toString());return t}static deserializeParams(e){const t=[];for(const n of e)"string"==typeof n?t.push(BigInt(n)):t.push(n);return t}static serializeResult(e){return"bigint"==typeof e?e.toString():"number"==typeof e?e:void 0}static deserializeResult(e){if(void 0!==e)return"number"==typeof e?e:BigInt(e)}static loadResult(e){const t=new DataView(e,0,p.Header.end.offset),n=t.getUint32(p.Header.resultType.offset,!0);switch(n){case d.WasmTypeKind.undefined:return;case d.WasmTypeKind.float:return t.getFloat64(p.Header.result.offset,!0);case d.WasmTypeKind.signed:return t.getBigInt64(p.Header.result.offset,!0);case d.WasmTypeKind.unsigned:return t.getBigUint64(p.Header.result.offset,!0);default:throw new l.ComponentModelTrap(`Unexpected result type ${n}`)}}static storeResult(e,t){const n=new DataView(e,0,p.Header.end.offset);if(void 0===t)n.setUint32(p.Header.resultType.offset,d.WasmTypeKind.undefined,!0);else if("bigint"==typeof t)t<0?(n.setUint32(p.Header.resultType.offset,d.WasmTypeKind.signed,!0),n.setBigInt64(p.Header.result.offset,t,!0)):(n.setUint32(p.Header.resultType.offset,d.WasmTypeKind.unsigned,!0),n.setBigUint64(p.Header.result.offset,t,!0));else{if("number"!=typeof t)throw new l.ComponentModelTrap(`Unexpected result type ${t}`);n.setUint32(p.Header.resultType.offset,d.WasmTypeKind.float,!0),n.setFloat64(p.Header.result.offset,t,!0)}}}t.Connection=d,function(e){let t,n;!function(e){e[e.noHandler=1]="noHandler",e[e.promiseRejected=2]="promiseRejected"}(t=e.ErrorCodes||(e.ErrorCodes={})),function(e){e[e[void 0]=0]="undefined",e[e.float=1]="float",e[e.signed=2]="signed",e[e.unsigned=3]="unsigned"}(n=e.WasmTypeKind||(e.WasmTypeKind={}))}(d||(t.Connection=d={})),t.BaseWorkerConnection=class extends d{world;timeout;handlers;constructor(e,t){super(new p),this.world=e,this.timeout=t,this.handlers=new Map}dispose(){this.handlers.clear()}on(e,t){this.handlers.set(e,t)}getMemory(){return this.memory}prepareCall(){this.memory.reset()}callMain(e,t){const n=this.memory.buffer,r=new Int32Array(n,p.Header.sync.offset,1);Atomics.store(r,0,0);const o={method:"callMain",name:e,params:d.serializeParams(t),memory:{buffer:this.memory.buffer,id:this.memory.id}};switch(this.postMessage(o),Atomics.wait(r,0,0,this.timeout)){case"timed-out":throw new l.ComponentModelTrap(`Call ${e} to main thread timed out`);case"not-equal":const t=Atomics.load(r,0);if(1!==t)throw new l.ComponentModelTrap(`Unexpected value ${t} in sync object`)}return d.loadResult(n)}handleMessage(e){if("initializeWorker"===e.method){const t=new l.WasmContext.Default(e.options),n=l.$imports.worker.create(this,this.world,t);void 0!==e.memory&&(n.env.memory=e.memory),(0,u.default)().WebAssembly.instantiate(e.module,n).then((e=>{t.initialize(new l.Memory.Default(e.exports)),l.$exports.worker.bind(this,this.world,e.exports,t),this.postMessage({method:"reportResult",name:"$initializeWorker",result:"success"})})).catch((e=>{this.postMessage({method:"reportResult",name:"$initializeWorker",error:e.toString()})}))}else if("callWorker"===e.method){const t=this.handlers.get(e.name);if(void 0===t)return void this.postMessage({method:"reportResult",name:e.name,error:`No handler found for ${e.name}`});try{const n=t(new p(e.memory.buffer,e.memory.id),d.deserializeParams(e.params));this.postMessage({method:"reportResult",name:e.name,result:d.serializeResult(n)})}catch(t){this.postMessage({method:"reportResult",name:e.name,error:`Calling WASM function ${e.name} failed.`})}}}},t.BaseMainConnection=class extends d{initializeCall;handlers;callQueue;currentCall;constructor(){super(new p),this.handlers=new Map,this.callQueue=new f.Semaphore(1),this.currentCall=void 0}dispose(){this.handlers.clear(),this.callQueue.dispose()}lock(e){return this.callQueue.lock(e)}prepareCall(){this.memory.reset()}getMemory(){return this.memory}async initialize(e,t){let n,r;return void 0!==e.module?(n=e.module,r=e.memory):n=e,new Promise(((e,o)=>{const i={method:"initializeWorker",module:n,memory:r,options:t};this.initializeCall={resolve:e,reject:o},this.postMessage(i)}))}callWorker(e,t){if(void 0!==this.currentCall)throw new l.ComponentModelTrap("Call already in progress");this.currentCall=c.CapturedPromise.create();const n={method:"callWorker",name:e,params:d.serializeParams(t),memory:{buffer:this.memory.buffer,id:this.memory.id}};return this.postMessage(n),this.currentCall.promise}on(e,t){this.handlers.set(e,t)}handleMessage(e){if("callMain"===e.method){const t=e.memory.buffer,n=new Int32Array(t,p.Header.sync.offset,1),r=new DataView(t,0,p.Header.end.offset),o=this.handlers.get(e.name);if(void 0===o)return r.setUint32(p.Header.errorCode.offset,d.ErrorCodes.noHandler,!0),Atomics.store(n,0,1),void Atomics.notify(n,0);{const i=o(new p(t,e.memory.id),d.deserializeParams(e.params));i instanceof Promise?i.then((e=>{d.storeResult(t,e)})).catch((()=>{r.setUint32(p.Header.errorCode.offset,d.ErrorCodes.promiseRejected,!0)})).finally((()=>{Atomics.store(n,0,1),Atomics.notify(n,0)})):(d.storeResult(t,i),Atomics.store(n,0,1),Atomics.notify(n,0))}}else if("reportResult"===e.method)if("$initializeWorker"===e.name){if(void 0===this.initializeCall)return;void 0!==e.error?this.initializeCall.reject(new Error(e.error)):this.initializeCall.resolve(),this.initializeCall=void 0}else{if(void 0===this.currentCall)return;if(void 0!==e.error)this.currentCall.reject(new Error(e.error));else{const t=d.deserializeResult(e.result);this.currentCall.resolve(t)}this.currentCall=void 0}}}},696:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.CapturedPromise=void 0,function(e){e.create=function(){let e,t;return{promise:new Promise(((n,r)=>{e=n,t=r})),resolve:e,reject:t}}}(n||(t.CapturedPromise=n={}))},927:(e,t)=>{let n;function r(){if(void 0===n)throw new Error("No runtime abstraction layer installed");return n}Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.install=function(e){if(void 0===e)throw new Error("No runtime abstraction layer provided");n=e},e.isInstalled=function(){return void 0!==n}}(r||(r={})),t.default=r},534:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Semaphore=void 0;const o=r(n(927));t.Semaphore=class{_capacity;_active;_waiting;constructor(e=1){if(e<=0)throw new Error("Capacity must be greater than 0");this._capacity=e,this._active=0,this._waiting=[]}dispose(){for(const e of this._waiting)e.reject(new Error("Semaphore disposed"));this._active=0,this._waiting=[]}lock(e){return new Promise(((t,n)=>{this._waiting.push({thunk:e,resolve:t,reject:n}),this.runNext()}))}get active(){return this._active}runNext(){0!==this._waiting.length&&this._active!==this._capacity&&(0,o.default)().timer.setImmediate((()=>this.doRunNext()))}doRunNext(){if(0===this._waiting.length||this._active===this._capacity)return;const e=this._waiting.shift();if(this._active++,this._active>this._capacity)throw new Error("To many thunks active");try{const t=e.thunk();t instanceof Promise?t.then((t=>{this._active--,e.resolve(t),this.runNext()}),(t=>{this._active--,e.reject(t),this.runNext()})):(this._active--,e.resolve(t),this.runNext())}catch(t){this._active--,e.reject(t),this.runNext()}}}},344:function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),i(n(406)).default.install(),o(n(828),t)},406:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(23),i=n(167),s=r(n(927)),a=Object.freeze({TextEncoder:Object.freeze({create:(e="utf-8")=>({encode:t=>Buffer.from(t??"",e)})}),TextDecoder:Object.freeze({create:(e="utf-8")=>new o.TextDecoder(e)}),console,timer:Object.freeze({setTimeout(e,t,...n){const r=setTimeout(e,t,...n);return{dispose:()=>clearTimeout(r)}},setImmediate(e,...t){const n=setImmediate(e,...t);return{dispose:()=>clearImmediate(n)}},setInterval(e,t,...n){const r=setInterval(e,t,...n);return{dispose:()=>clearInterval(r)}}}),Connection:Object.freeze({async createWorker(e,t,r){if(void 0===e&&(e=i.parentPort),!(e instanceof MessagePort))throw new Error("Expected MessagePort");return new((await n.e(881).then(n.bind(n,881))).WorkerConnection)(e,t,r)},async createMain(e){if(!(e instanceof MessagePort||e instanceof i.Worker))throw new Error("Expected MessagePort or Worker");return new((await n.e(881).then(n.bind(n,881))).MainConnection)(e)}}),Worker:Object.freeze({getPort:()=>i.parentPort,getArgs:()=>process.argv.slice(2),get exitCode(){return process.exitCode},set exitCode(e){process.exitCode=e}}),WebAssembly:Object.freeze({compile:e=>WebAssembly.compile(e),instantiate:(e,t)=>WebAssembly.instantiate(e,t)})});function l(){return a}!function(e){e.install=function(){s.default.isInstalled()||s.default.install(a)}}(l||(l={})),s.default.isInstalled()||s.default.install(a),t.default=l},265:function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.activate=async function(e){console.log("tergo activated");const t=s.Uri.joinPath(e.extensionUri,"scopa.wasm");console.log(`Looking for the WASM under ${t}`);const n=await s.workspace.fs.readFile(t),r=await WebAssembly.compile(n),o=new a.WasmContext.Default,i=await WebAssembly.instantiate(r,{});o.initialize(new a.Memory.Default(i.exports));const c=l.tergo._.exports.bind(i.exports,o);s.languages.registerDocumentFormattingEditProvider("r",{provideDocumentFormattingEdits(e,t,n){let r=e.getText();return console.log(`Formatting the document:\n${r}`),[s.TextEdit.replace(new s.Range(e.lineAt(0).range.start,e.lineAt(e.lineCount-1).range.end),c.format(r))]}})},t.deactivate=function(){console.log("tergo deactivated")};const s=i(n(398)),a=n(344),l=n(553)},553:function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.tergo=void 0;const s=i(n(344));var a;!function(e){!function(e){let t,n;!function(e){e.log=new s.FunctionType("log",[["msg",s.wstring]],void 0)}(t=e.imports||(e.imports={})),function(e){e.format=new s.FunctionType("format",[["code",s.wstring]],new s.ResultType(s.wstring,s.wstring,s.wstring.Error))}(n=e.exports||(e.exports={}))}(e.$||(e.$={}))}(a||(t.tergo=a={})),function(e){!function(t){let n,r;var o;t.id="vscode:tergo/tergo",t.witName="tergo",function(n){n.functions=new Map([["log",e.$.imports.log]]),n.create=function(e,n){return s.$imports.create(t,e,n)},n.loop=function(e,n){return s.$imports.loop(t,e,n)}}(n=t.imports||(t.imports={})),(o=r=t.exports||(t.exports={})).functions=new Map([["format",e.$.exports.format]]),o.bind=function(e,n){return s.$exports.bind(t,e,n)},t.bind=function(e,n,r,o){return s.$main.bind(t,e,n,r,o)}}(e._||(e._={}))}(a||(t.tergo=a={}))},899:(e,t,n)=>{n.r(t),n.d(t,{NIL:()=>x,parse:()=>w,stringify:()=>p,v1:()=>g,v3:()=>b,v4:()=>A,v5:()=>_,validate:()=>c,version:()=>$});const r=require("crypto");var o=n.n(r);const i=new Uint8Array(256);let s=i.length;function a(){return s>i.length-16&&(o().randomFillSync(i),s=0),i.slice(s,s+=16)}const l=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,c=function(e){return"string"==typeof e&&l.test(e)},u=[];for(let e=0;e<256;++e)u.push((e+256).toString(16).slice(1));function f(e,t=0){return u[e[t+0]]+u[e[t+1]]+u[e[t+2]]+u[e[t+3]]+"-"+u[e[t+4]]+u[e[t+5]]+"-"+u[e[t+6]]+u[e[t+7]]+"-"+u[e[t+8]]+u[e[t+9]]+"-"+u[e[t+10]]+u[e[t+11]]+u[e[t+12]]+u[e[t+13]]+u[e[t+14]]+u[e[t+15]]}const p=function(e,t=0){const n=f(e,t);if(!c(n))throw TypeError("Stringified UUID is invalid");return n};let d,y,h=0,m=0;const g=function(e,t,n){let r=t&&n||0;const o=t||new Array(16);let i=(e=e||{}).node||d,s=void 0!==e.clockseq?e.clockseq:y;if(null==i||null==s){const t=e.random||(e.rng||a)();null==i&&(i=d=[1|t[0],t[1],t[2],t[3],t[4],t[5]]),null==s&&(s=y=16383&(t[6]<<8|t[7]))}let l=void 0!==e.msecs?e.msecs:Date.now(),c=void 0!==e.nsecs?e.nsecs:m+1;const u=l-h+(c-m)/1e4;if(u<0&&void 0===e.clockseq&&(s=s+1&16383),(u<0||l>h)&&void 0===e.nsecs&&(c=0),c>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");h=l,m=c,y=s,l+=122192928e5;const p=(1e4*(268435455&l)+c)%4294967296;o[r++]=p>>>24&255,o[r++]=p>>>16&255,o[r++]=p>>>8&255,o[r++]=255&p;const g=l/4294967296*1e4&268435455;o[r++]=g>>>8&255,o[r++]=255&g,o[r++]=g>>>24&15|16,o[r++]=g>>>16&255,o[r++]=s>>>8|128,o[r++]=255&s;for(let e=0;e<6;++e)o[r+e]=i[e];return t||f(o)},w=function(e){if(!c(e))throw TypeError("Invalid UUID");let t;const n=new Uint8Array(16);return n[0]=(t=parseInt(e.slice(0,8),16))>>>24,n[1]=t>>>16&255,n[2]=t>>>8&255,n[3]=255&t,n[4]=(t=parseInt(e.slice(9,13),16))>>>8,n[5]=255&t,n[6]=(t=parseInt(e.slice(14,18),16))>>>8,n[7]=255&t,n[8]=(t=parseInt(e.slice(19,23),16))>>>8,n[9]=255&t,n[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,n[11]=t/4294967296&255,n[12]=t>>>24&255,n[13]=t>>>16&255,n[14]=t>>>8&255,n[15]=255&t,n};function v(e,t,n){function r(e,r,o,i){var s;if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));const t=[];for(let n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t}(e)),"string"==typeof r&&(r=w(r)),16!==(null===(s=r)||void 0===s?void 0:s.length))throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let a=new Uint8Array(16+e.length);if(a.set(r),a.set(e,r.length),a=n(a),a[6]=15&a[6]|t,a[8]=63&a[8]|128,o){i=i||0;for(let e=0;e<16;++e)o[i+e]=a[e];return o}return f(a)}try{r.name=e}catch(e){}return r.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",r.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",r}const b=v("v3",48,(function(e){return Array.isArray(e)?e=Buffer.from(e):"string"==typeof e&&(e=Buffer.from(e,"utf8")),o().createHash("md5").update(e).digest()})),T={randomUUID:o().randomUUID},A=function(e,t,n){if(T.randomUUID&&!t&&!e)return T.randomUUID();const r=(e=e||{}).random||(e.rng||a)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=r[e];return t}return f(r)},_=v("v5",80,(function(e){return Array.isArray(e)?e=Buffer.from(e):"string"==typeof e&&(e=Buffer.from(e,"utf8")),o().createHash("sha1").update(e).digest()})),x="00000000-0000-0000-0000-000000000000",$=function(e){if(!c(e))throw TypeError("Invalid UUID");return parseInt(e.slice(14,15),16)}},398:e=>{e.exports=require("vscode")},23:e=>{e.exports=require("util")},167:e=>{e.exports=require("worker_threads")}},n={};function r(e){var o=n[e];if(void 0!==o)return o.exports;var i=n[e]={exports:{}};return t[e].call(i.exports,i,i.exports,r),i.exports}r.m=t,r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.f={},r.e=e=>Promise.all(Object.keys(r.f).reduce(((t,n)=>(r.f[n](e,t),t)),[])),r.u=e=>e+".extension.js",r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},e={792:1},r.f.require=(t,n)=>{e[t]||(t=>{var n=t.modules,o=t.ids,i=t.runtime;for(var s in n)r.o(n,s)&&(r.m[s]=n[s]);i&&i(r);for(var a=0;a<o.length;a++)e[o[a]]=1})(require("./"+r.u(t)))};var o=r(265);module.exports=o})();